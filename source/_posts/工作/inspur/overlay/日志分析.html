---
title:  overlay日志分析
date: 2019-08-26 10:57:34  
categories:
- 工作
- inspur
- overlay
tags: 
- overlay
description: overlay日志分析
export_on_save:
    html: true
html:
  embed_local_images: false
  embed_svg: true
  offline: false
  toc: false
---
<!DOCTYPE html><html><head>
      <title>overlay&#x65E5;&#x5FD7;&#x5206;&#x6790;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css">
      
      

      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h2 class="mume-header" id="1-overlay%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90">1. overlay&#x65E5;&#x5FD7;&#x5206;&#x6790;</h2>

<h3 class="mume-header" id="11-%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C">1.1. &#x521B;&#x5EFA;&#x7F51;&#x7EDC;</h3>

<p><strong>&#x65E5;&#x5FD7;</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">#### &#x521B;&#x5EFA;&#x7F51;&#x7EDC; overlay netruon &#x4ECB;&#x5165; #####</span>
 IceNeutronNetworkChangeListener   IceNeutronNetworkChangeListener data tree changed.

  IceNeutronNetworkChangeListener   WRITE IceNetwork IceNeutronNetworkChangeListener
  
  IceNeutronNetworkChangeListener   Adding Network:Name<span class="token operator">=</span>network, isAdminStateUp<span class="token operator">=</span>true, isShared<span class="token operator">=</span>false,getNetworkType<span class="token operator">=</span>IceNetworkTypeVxlan, getSegmentationId<span class="token operator">=</span>10071<span class="token punctuation">}</span>, IceNetworkL3Extension<span class="token punctuation">{</span>isExternal<span class="token operator">=</span>false<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">#### mapper &#x4ECB;&#x5165; &#x5199;&#x5165;vxlan id ####</span>
 IceNeutronUtils                   getSegmentationId 10071

  IceNeutronNetworkChangeListener   Network segmentationID: value<span class="token operator">=</span>10071

  IceNeutronNetworkChangeListener   handle vxlan network created with segmentationId 10071

<span class="token comment">#### &#x83B7;&#x53D6;server&#x4FE1;&#x606F;  ####</span>
 IceNeutronUtils                   serverLeafSet:<span class="token punctuation">[</span>Uri <span class="token punctuation">[</span>_value<span class="token operator">=</span>iceDeviceId:172.20.1.174<span class="token punctuation">]</span><span class="token punctuation">]</span>

 IceVxlanManager                   ChannelId is <span class="token keyword">:</span> Uri <span class="token punctuation">[</span>_value<span class="token operator">=</span>iceDeviceId:172.20.1.174<span class="token punctuation">]</span> with device <span class="token keyword">:</span> Uri <span class="token punctuation">[</span>_value<span class="token operator">=</span>iceDeviceId:172.20.1.174<span class="token punctuation">]</span>

<span class="token comment">#### &#x83B7;&#x53D6;vlan id #### </span>
 IceOverlayPoolsManager           Allocate id: 500 ,poolType :1

<span class="token comment">#### ICe vxlan&#x4ECB;&#x5165; #### </span>
 IceVxlanCacheManager              writeL2Vxlan IceDeviceVxlanL2 iceDeviceId:172.20.1.174, _iceNetworkId<span class="token operator">=</span>21e67093-9cf3-4172-9943-64fca7be2da5, _iceNetworkType<span class="token operator">=</span>IceNetworkTypeVxlan, _iceVlanId<span class="token operator">=</span>500, _iceVxlanId<span class="token operator">=</span>10071

  IceVxlanL2ChangeListener         IceVxlanL2ChangeListener Write

<span class="token comment">#### overlay&#x8C03;&#x7528;underlay&#x4E0B;&#x53D1;&#x914D;&#x7F6E; ####</span>
  DistributeConfig                  distribute vxlanConfigl2Dynamic input VconfigType<span class="token operator">=</span>Config, _deviceIp<span class="token operator">=</span>Ipv4Address <span class="token punctuation">[</span>_value<span class="token operator">=</span>172.20.1.174<span class="token punctuation">]</span>, vlanId<span class="token operator">=</span>500, _vni<span class="token operator">=</span>10071, _isMulticastMode<span class="token operator">=</span>true

  ConfigCache                       init vni <span class="token keyword">:</span> 10071 <span class="token keyword">for</span> device <span class="token keyword">:</span> iceDeviceId:172.20.1.174

  DistributeConfig                  modifyDeviceVniCache <span class="token boolean">true</span>

  EvpnVni                           config segmentId start

  DevInfo                           deviceIp<span class="token operator">=</span>172.20.1.174, deviceType<span class="token operator">=</span>CN61108PC-V

<span class="token comment">#### underlay &#x7B2C;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#xFF08;&#x4E3B;&#x8981;&#x914D;&#x7F6E;vni&#xFF09; l2Config.configEvpnL2 ####</span>
  HttpPostCmd                       devIpAdd is :172.20.1.174 and nxapi commands: config terminal <span class="token punctuation">;</span>feature nv overlay  <span class="token punctuation">;</span>feature vn-segment-vlan-based  <span class="token punctuation">;</span>nv overlay evpn  <span class="token punctuation">;</span>evpn <span class="token punctuation">;</span>vni 10071 L2 <span class="token punctuation">;</span>rd auto <span class="token punctuation">;</span>route-target <span class="token function">import</span> auto <span class="token punctuation">;</span>route-target <span class="token function">export</span> auto <span class="token punctuation">;</span><span class="token keyword">exit</span>
  
  EvpnVni                           save segment <span class="token function">id</span> of 172.20.1.174 succeeded

  EvpnVni                           configSegmentId <span class="token function">command</span> <span class="token function">exec</span> succeed, deviceIp is :172.20.1.174

  DevInfo                           deviceIp<span class="token operator">=</span>172.20.1.174, deviceType<span class="token operator">=</span>CN61108PC-V

<span class="token comment">#### underlay &#x7B2C;&#x4E8C;&#x6761;&#x547D;&#x4EE4;&#xFF08;&#x914D;&#x7F6E;vlan-vxlan&#x6620;&#x5C04;&#xFF09; l2Config.configVlanVnSegmentL2 ####</span>
  HttpPostCmd                       devIpAdd is :172.20.1.174 and nxapi commands: config terminal <span class="token punctuation">;</span>feature nv overlay  <span class="token punctuation">;</span>feature vn-segment-vlan-based  <span class="token punctuation">;</span>nv overlay evpn  <span class="token punctuation">;</span>vlan 500 <span class="token punctuation">;</span>no vn-segment <span class="token punctuation">;</span>vn-segment 10071 <span class="token punctuation">;</span>end

  Vlan                              configVlanVnSegment sendCommands <span class="token keyword">return</span> :true

  Vlan                              vlan is not created, so create vlan<span class="token operator">!</span>

<span class="token comment">#### overlay mapper&#x6536;&#x5230;&#x5BF9;device switch &#x7684;vlan&#x53F7;&#x4FEE;&#x6539; l2Config.configNve1L2Multicast ####</span>
  IceLeafSwitchChangeListener       LeafSwitch getDeviceVlanId<span class="token operator">=</span>1,500, &#x4FEE;&#x6539;device vlan
  
  IceUnderlayPoolManager           <span class="token operator">|</span> 44 - com.inspur.ice.resourcepool-impl - 0.1.0 <span class="token operator">|</span> Allocate ip: 225.0.0.1 ,poolType :9

  DevInfo                           deviceIp<span class="token operator">=</span>172.20.1.174, deviceType<span class="token operator">=</span>CN61108PC-V

<span class="token comment">#### underlay &#x7B2C;&#x4E09;&#x6761;&#x547D;&#x4EE4;&#xFF08;&#x914D;&#x7F6E;bgp loopback&#xFF09;####</span>
  HttpPostCmd                       devIpAdd is :172.20.1.174 and nxapi commands: config terminal <span class="token punctuation">;</span>feature nv overlay  <span class="token punctuation">;</span>feature vn-segment-vlan-based  <span class="token punctuation">;</span>nv overlay evpn  <span class="token punctuation">;</span>interface nve1 <span class="token punctuation">;</span>host-reachability protocol bgp <span class="token punctuation">;</span><span class="token function">shutdown</span> <span class="token punctuation">;</span>source-interface loopback 95 <span class="token punctuation">;</span>no <span class="token function">shutdown</span> <span class="token punctuation">;</span>member vni 10071 <span class="token punctuation">;</span>suppress-arp  <span class="token punctuation">;</span>mcast-group 225.0.0.1 <span class="token punctuation">;</span>end

</pre><p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<p>&#x2003;&#x90E8;&#x5206;&#x914D;&#x7F6E;&#x5BF9;&#x4E0D;&#x4E0A;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x6B21;&#x622A;&#x53D6;</p>
<pre data-role="codeBlock" data-info class="language-"><code>vlan 2
  vn-segment 10070

interface nve1
  no shutdown
  host-reachability protocol bgp
  source-interface loopback95
  member vni 10070
    suppress-arp
    mcast-group 225.0.0.1

router bgp 65101
evpn
  vni 10070 l2
    rd auto
    route-target import auto
    route-target export auto
</code></pre><p><strong>&#x547D;&#x4EE4;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;evpn ;vni 10071 L2 ;rd auto ;route-target import auto ;route-target export auto ;exit

devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;vlan 500 ;no vn-segment ;vn-segment 10071 ;end

devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;interface nve1 ;host-reachability protocol bgp ;shutdown ;source-interface loopback 95 ;no shutdown ;member vni 10071 ;suppress-arp  ;mcast-group 225.0.0.1 ;end
</code></pre><h3 class="mume-header" id="12-%E5%88%9B%E5%BB%BA%E5%AD%90%E7%BD%91%E5%90%8C%E6%97%B6%E4%BC%9A%E5%88%9B%E5%BB%BAdhcp%E7%AB%AF%E5%8F%A3">1.2. &#x521B;&#x5EFA;&#x5B50;&#x7F51;&#xFF08;&#x540C;&#x65F6;&#x4F1A;&#x521B;&#x5EFA;dhcp&#x7AEF;&#x53E3;&#xFF09;</h3>

<p><strong>&#x65E5;&#x5FD7;&#x5206;&#x6790;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code> 
#### Ice Neutron&#x4ECB;&#x5165;&#x76D1;&#x542C;&#x5230;&#x5B50;&#x7F51;&#x521B;&#x5EFA;  ####
IceNeutronSubnetChangeListener      IceNeutronSubnetChangeListener data tree changed.
IceNeutronSubnetChangeListener      WRITE IceSubnet IceNeutronSubnetChangeListener
IceNeutronSubnetChangeListener      Adding Subnet : 
IceNeutronUtils                     getSegmentationId 10071

#### overlay mapper &#x4ECB;&#x5165;&#xFF0C;&#x5199; vxlan l2  ####
IceNeutronUtils                     serverLeafSet:[Uri [_value=iceDeviceId:172.20.1.177], Uri [_value=iceDeviceId:172.20.1.174]]
IceVxlanL2ChangeListener            IceVxlanL2ChangeListener &#x5199;&#x5165;subnet&#x4FE1;&#x606F;
ConfigCache                         ADD IceDeviceVxlanL2{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], getIceInterfaceConfig=[], getIceNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getIceSubnet=[IceSubnet{getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=500], getIceVxlanId=IceVxlanId [_value=10071], augmentations={}} failed

#### Ice Neutron&#x4ECB;&#x5165;&#x76D1;&#x542C;dhcp port&#x521B;&#x5EFA; (&#x591A;&#x6B21;&#x4FE1;&#x606F;&#x5199;&#x5165;)####
IceNeutronPortChangeListener        IceNeutronPortChangeListener data tree changed.
IceNeutronPortChangeListener        IcePort data tree changed.
IceNeutronPortChangeListener        port vtepType null
IceNeutronPortChangeListener        IceNeutronPortChangeListener data tree changed.
IceNeutronPortChangeListener        port vtepType HW
IceNeutronPortChangeListener        Add ice port with hw host
IceVxlanManager                     getHostNodeFromHostName jw-controller
IceVxlanManager                     uncompleted topology 
IceNeutronPortChangeListener        Get portBindingInfo [IceVxlanManager$PortBindingInfo@16b5b00c] with icePort Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]

#### overlay mapper &#x4ECB;&#x5165;&#xFF0C;&#x5199;vxlan l2####
IceVlanCacheManager                 writeNeutronSubnet 
IceVlanCacheManager                 writeNeutronPort Port
netvirt.natservice.internal.NatUtil getSubnetGwMac : No GW ip found for subnet 49c27f08-05d1-3f62-a810-91a6f700856a
NeutronPortChangeListener           NeutronPortChangeListener data tree changed.
NeutronPortChangeListener           NeutronPortChangeListener data tree changed write.
IceVxlanCacheManager                writeIceInterfacePort IceInterfaceConfig 

#### overlay config &#x4ECB;&#x5165;&#xFF0C;&#x51C6;&#x5907;&#x4E0B;&#x53D1;&#x914D;&#x7F6E; ####
IceVxlanL2ChangeListener            IceVxlanL2ChangeListener Write &#x7AEF;&#x53E3;&#x5199;&#x5165;
DevInfo                             deviceIp=172.20.1.177, deviceType=CN61108TC-V
SshcProvider                        sshInput is : SshInput [_enablePassword=inspur@123, _sshCommand=[SshCommand [_command=show running-config interface Ethernet1/1, augmentation=[]]], _sshIp=172.20.1.177, _sshPassword=inspur@123, _sshUser=admin, _nxapiUsed=false, augmentation=[]]

#### netvirt &#x4ECB;&#x5165;####
NeutronvpnManager                   updateSubnetmapNodeWithPorts 
NatUtil                             getSubnetGwMac : No GW ip found for subnet 49c27f08-05d1-3f62-a810-91a6f700856a
VpnSubnetRouteHandler               SUBNETROUTE: onPortAddedToSubnet: Port 85617daf-4a17-49c0-a3a2-9841625aa5c9 being added to subnet 49c27f08-05d1-3f62-a810-91a6f700856a

#### genius &#x4ECB;&#x5165;####
InterfacemgrProvider                Interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 is not present
ElanInterfaceManager                Interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 is removed from Interface Oper DS due to port down
InterfaceConfigListener             parent refs not specified for 85617daf-4a17-49c0-a3a2-9841625aa5c9

#### &#x8FD4;&#x56DE;netvirt ####
VpnSubnetRouteHandler               SUBNETROUTE


#### underlay  &#x4E0B;&#x53D1;&#x914D;&#x7F6E; ####
SshcProvider
Vlan                            checkPortIsInPortChannel sendCommands return :true
VlanProvider                    setPort2VlanMode start
IceLeafSwitchChangeListener     LeafSwitch  write.
DevInfo                         deviceIp=172.20.1.177, deviceType=CN61108TC-V
HttpPostCmd                     devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;vlan  500 ;interface Ethernet1/1 ;switchport  ;switchport mode trunk ;switchport trunk allowed vlan  500 ;no shutdown
Vlan                            setPort2VlanMode1 sendCommands return :true

#### genius netvirt &#x4ECB;&#x5165;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x72B6;&#x6001; ietf-interfaces:interfaces-state ####
statehelpers.OvsInterfaceStateAddHelper Adding Interface State to Oper DS for interface: tap85617daf-4a
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: add: Processed interface tap85617daf-4a up event


genius.utils.batching.ResourceBatchingManager Total taken ##time = 2ms for resourceList of size 1 for resourceType INTERFACEMGR-DEFAULT-OPERATIONAL
genius.interfacemanager.renderer.ovs.confighelpers.OvsInterfaceConfigUpdateHelper port attributes modified, requires a delete and recreate of 85617daf-4a17-49c0-a3a2-9841625aa5c9 configuration
genius.interfacemanager.commons.InterfaceManagerCommonUtils Creating child interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 of type Trunk bound on parent-interface tap85617daf-4a
genius.interfacemanager.renderer.ovs.confighelpers.OvsInterfaceConfigAddHelper adding vlan configuration for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9

#### genius id manager&#x5206;&#x914D;id####
genius.idmanager.IdManager Got pool IdLocalPool [poolName=interfaces.2130706689, availableIds=AvailableIdHolder [low=1, high=6553, cur=3], releasedIds=ReleasedIdHolder [availableIdCount=2, timeDelaySec=30, delayedEntries=[{Id: 3 ReadyTimeSec: 1553930804}, {Id: 1 ReadyTimeSec: 1553930806}]]]
genius.idmanager.IdManager The newIdValues [3] for the idKey 85617daf-4a17-49c0-a3a2-9841625aa5c9

#### genius netvirt &#x7ED1;&#x5B9A;&#x670D;&#x52A1; &#xFF08;datastore interface-service-bindings&#xFF09;####
####
    {
        &quot;name&quot;: &quot;85617daf-4a17-49c0-a3a2-9841625aa5c9&quot;,
        &quot;type&quot;: &quot;iana-if-type:l2vlan&quot;,
        &quot;enabled&quot;: true,
        &quot;odl-interface:l2vlan-mode&quot;: &quot;trunk&quot;,
        &quot;odl-interface:parent-interface&quot;: &quot;tap85617daf-4a&quot;
      }
####

genius.interfacemanager.IfmUtil Binding Service default.85617daf-4a17-49c0-a3a2-9841625aa5c9 for : 85617daf-4a17-49c0-a3a2-9841625aa5c9
netvirt.vpnmanager.InterfaceStateChangeListener VPN Interface add event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 from InterfaceStateChangeListener
netvirt.natservice.internal.NatInterfaceStateChangeListener call : Unable to process add for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9
netvirt.vpnmanager.InterfaceStateChangeListener Detected interface add event for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9
genius.interfacemanager.servicebindings.flowbased.listeners.FlowBasedServicesConfigListener Service Binding Entry created for Interface: 85617daf-4a17-49c0-a3a2-9841625aa5c9, ServiceName: default.85617daf-4a17-49c0-a3a2-9841625aa5c9, ServicePriority 9
genius.interfacemanager.servicebindings.flowbased.utilities.FlowBasedServicesUtils adding bound-service state information for interface : 85617daf-4a17-49c0-a3a2-9841625aa5c9, service-mode : yang.gen.v1.urn.opendaylight.genius.interfacemanager.servicebinding.rev160406.ServiceModeEgress
netvirt.ipv6service.Ipv6ServiceInterfaceEventListener Port Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9] does not include IPv6Address, skipping.

#### genius netvirt &#x6536;&#x5230; 85617daf-4a17-49c0-a3a2-9841625aa5c9 &#x7AEF;&#x53E3;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x4E8B;&#x4EF6;####
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: add: Processed interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 up event
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: add: Received port UP event for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 subnetId 49c27f08-05d1-3f62-a810-91a6f700856a

genius.interfacemanager.servicebindings.flowbased.config.helpers.FlowBasedEgressServicesConfigBindHelper binding egress service default.85617daf-4a17-49c0-a3a2-9841625aa5c9 for interface: 85617daf-4a17-49c0-a3a2-9841625aa5c9
genius.idmanager.jobs.UpdateIdEntryJob Updated id entry with idValues [3], idKey 85617daf-4a17-49c0-a3a2-9841625aa5c9, pool interfaces.2130706689

#### DpnInterfaceListener &#x76D1;&#x542C;elan &#xFF0C;&#x4FDD;&#x8BC1;&#x8DEF;&#x7531;&#x901A;&#x544A;&#x6D88;&#x606F;&#x8FDB;&#x5165;####
DpnInterfaceListener DpnInterfaceListener data tree changed.
DpnInterfaceListener begin processFlowTableEgressAclDel
DpnInterfaceListener data is null or dpninterface is null!!
genius.interfacemanager.InterfacemgrProvider Create VLAN interface : 115377256237675:ens192:500
DpnInterfaceListener begin processFlowTableEgressAclAdd!!!
DpnInterfaceListener begin for ifname is 85617daf-4a17-49c0-a3a2-9841625aa5c9!!!
DpnInterfaceListener begin getIcePortByIfName 85617daf-4a17-49c0-a3a2-9841625aa5c9
com.inspur.ice.overlaymapper.util.Utils begin getIcePortByIfName 85617daf-4a17-49c0-a3a2-9841625aa5c9
com.inspur.ice.overlaymapper.util.Utils begin read ds 85617daf-4a17-49c0-a3a2-9841625aa5c9
DpnInterfaceListener begin check is nova port
genius.interfacemanager.InterfacemgrProvider Interface 115377256237675:ens192:500 is not present
netvirt.elan.internal.ElanInterfaceManager Interface 115377256237675:ens192:500 is removed from Interface Oper DS due to port down
genius.interfacemanager.renderer.ovs.confighelpers.OvsVlanMemberConfigAddHelper adding vlan member configuration for interface 115377256237675:ens192:500

#### genius id manager&#x5206;&#x914D;id(&#x4E0A;&#x9762;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x540E;&#x9762;&#x624D;&#x521B;&#x5EFA;&#xFF1F;)####
genius.idmanager.IdManager Got pool IdLocalPool [poolName=interfaces.2130706689, availableIds=AvailableIdHolder [low=1, high=6553, cur=3], releasedIds=ReleasedIdHolder [availableIdCount=1, timeDelaySec=30, delayedEntries=[{Id: 1 ReadyTimeSec: 1553930806}]]]
genius.idmanager.IdManager The newIdValues [1] for the idKey 115377256237675:ens192:500
genius.idmanager.jobs.UpdateIdEntryJob Updated id entry with idValues [1], idKey 115377256237675:ens192:500, pool interfaces.2130706689
genius.interfacemanager.IfmUtil Binding Service default.115377256237675:ens192:500 for : 115377256237675:ens192:500
netvirt.vpnmanager.InterfaceStateChangeListener VPN Interface add event - intfName 115377256237675:ens192:500 from InterfaceStateChangeListener
netvirt.vpnmanager.InterfaceStateChangeListener Detected interface add event for interface 115377256237675:ens192:500
netvirt.natservice.internal.NatInterfaceStateChangeListener call : Unable to process add for interface 115377256237675:ens192:500

#### &#x53D1;&#x73B0;&#x670D;&#x52A1;&#x88AB;&#x7ED1;&#x5B9A;&#xFF0C;&#x4E0B;&#x53D1;&#x6D41;&#x8868; datastore interface-service-bindings####
genius.interfacemanager.servicebindings.flowbased.listeners.FlowBasedServicesConfigListener Service Binding Entry created for Interface: 115377256237675:ens192:500, ServiceName: default.115377256237675:ens192:500, ServicePriority 9
genius.interfacemanager.servicebindings.flowbased.utilities.FlowBasedServicesUtils adding bound-service state information for interface : 115377256237675:ens192:500, service-mode : yang.gen.v1.urn.opendaylight.genius.interfacemanager.servicebinding.rev160406.ServiceModeEgress
genius.interfacemanager.servicebindings.flowbased.config.helpers.FlowBasedEgressServicesConfigBindHelper binding egress service default.115377256237675:ens192:500 for interface: 115377256237675:ens192:500
genius.utils.batching.ResourceBatchingManager Total taken ##time = 2ms for resourceList of size 4 for resourceType INTERFACEMGR-DEFAULT-OPERATIONAL
netvirt.elan.internal.InterfaceAddWorkerOnElanInterface Handling elan interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 add for elan 476baec5-fd39-349d-a84e-57c1d2221ec5
DpnInterfaceListener DpnInterfaceListener data tree changed.
DpnInterfaceListener begin processFlowTableEgressAclDel
DpnInterfaceListener begin get EgressAclFlow 85617daf-4a17-49c0-a3a2-9841625aa5c9
DpnInterfaceListener begin get EgressAclFlowoption 85617daf-4a17-49c0-a3a2-9841625aa5c9
DpnInterfaceListener processFlowTableEgressAclDel EgressAclFlow is null!! ifname is 85617daf-4a17-49c0-a3a2-9841625aa5c9
DpnInterfaceListener begin processFlowTableEgressAclAdd!!!
DpnInterfaceListener begin for ifname is 85617daf-4a17-49c0-a3a2-9841625aa5c9!!!
DpnInterfaceListener begin getIcePortByIfName 85617daf-4a17-49c0-a3a2-9841625aa5c9
com.inspur.ice.overlaymapper.util.Utils begin getIcePortByIfName 85617daf-4a17-49c0-a3a2-9841625aa5c9
com.inspur.ice.overlaymapper.util.Utils begin read ds 85617daf-4a17-49c0-a3a2-9841625aa5c9
DpnInterfaceListener begin check is nova port
DpnInterfaceListener begin for ifname is 115377256237675:ens192:500!!!
DpnInterfaceListener ifname contain dpid , don&apos;t need process 115377256237675:ens192:500

####elan&#xFF0C;/operational/elan:elan-forwarding-tables  ####

netvirt.elan.internal.ElanInterfaceManager Programming remote dmac flows on the newly connected dpn 115377256237675 for elan 476baec5-fd39-349d-a84e-57c1d2221ec5
netvirt.elan.internal.ElanInterfaceManager programming smac and dmacs for fa:16:3e:d8:2c:da on source and other DPNs for elan 476baec5-fd39-349d-a84e-57c1d2221ec5 and interface 85617daf-4a17-49c0-a3a2-9841625aa5c9
netvirt.elan.evpn.listeners.ElanMacEntryListener ElanMacEntryListener : ADD macEntry KeyedInstanceIdentifier{targetType=interface yang.gen.v1.urn.opendaylight.netvirt.elan.rev150602.forwarding.entries.MacEntry, path=[yang.gen.v1.urn.opendaylight.netvirt.elan.rev150602.ElanForwardingTables, yang.gen.v1.urn.opendaylight.netvirt.elan.rev150602.elan.forwarding.tables.MacTable[key=MacTableKey [_elanInstanceName=476baec5-fd39-349d-a84e-57c1d2221ec5]], yang.gen.v1.urn.opendaylight.netvirt.elan.rev150602.forwarding.entries.MacEntry[key=MacEntryKey [_macAddress=PhysAddress [_value=fa:16:3e:d8:2c:da]]]]}
genius.interfacemanager.servicebindings.flowbased.listeners.FlowBasedServicesConfigListener Service Binding Entry created for Interface: 85617daf-4a17-49c0-a3a2-9841625aa5c9, ServiceName: elan.476baec5-fd39-349d-a84e-57c1d2221ec5.85617daf-4a17-49c0-a3a2-9841625aa5c9, ServicePriority 9
genius.interfacemanager.servicebindings.flowbased.utilities.FlowBasedServicesUtils adding bound-service state information for interface : 85617daf-4a17-49c0-a3a2-9841625aa5c9, service-mode : yang.gen.v1.urn.opendaylight.genius.interfacemanager.servicebinding.rev160406.ServiceModeIngress
genius.interfacemanager.servicebindings.flowbased.config.helpers.FlowBasedIngressServicesConfigBindHelper binding ingress service elan.476baec5-fd39-349d-a84e-57c1d2221ec5.85617daf-4a17-49c0-a3a2-9841625aa5c9 for vlan port: 85617daf-4a17-49c0-a3a2-9841625aa5c9

#### genius netvirt &#x6536;&#x5230;odl-interface:parent-interface&quot;: &quot;tap85617daf-4a &#x7AEF;&#x53E3;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x4E8B;&#x4EF6;####

netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Processed Interface tap85617daf-4a update event
netvirt.vpnmanager.InterfaceStateChangeListener VPN Interface update event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 from InterfaceStateChangeListener
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Processed Interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 update event
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Received port UP event for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 in subnet 49c27f08-05d1-3f62-a810-91a6f700856a
netvirt.elan.internal.InterfaceAddWorkerOnElanInterface Handling elan interface 115377256237675:ens192:500 add for elan 476baec5-fd39-349d-a84e-57c1d2221ec5
genius.interfacemanager.servicebindings.flowbased.listeners.FlowBasedServicesConfigListener Service Binding Entry created for Interface: 115377256237675:ens192:500, ServiceName: elan.476baec5-fd39-349d-a84e-57c1d2221ec5.115377256237675:ens192:500, ServicePriority 9
genius.interfacemanager.servicebindings.flowbased.utilities.FlowBasedServicesUtils adding bound-service state information for interface : 115377256237675:ens192:500, service-mode : yang.gen.v1.urn.opendaylight.genius.interfacemanager.servicebinding.rev160406.ServiceModeIngress
genius.interfacemanager.servicebindings.flowbased.config.helpers.FlowBasedIngressServicesConfigBindHelper binding ingress service elan.476baec5-fd39-349d-a84e-57c1d2221ec5.115377256237675:ens192:500 for vlan port: 115377256237675:ens192:500
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Processed Interface tap85617daf-4a update event
netvirt.vpnmanager.InterfaceStateChangeListener VPN Interface update event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 from InterfaceStateChangeListener
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Processed Interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 update event
netvirt.vpnmanager.SubnetRouteInterfaceStateChangeListener SUBNETROUTE: update: Received port UP event for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 in subnet 49c27f08-05d1-3f62-a810-91a6f700856a
IceNeutronPortChangeListener IceNeutronPortChangeListener data tree changed.
IceNeutronPortChangeListener IcePort data tree changed.
IceNeutronPortChangeListener WRITE
IceNeutronPortChangeListener Updating Port : original = IcePortKey [_uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]] update = IcePortKey [_uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]]
IceVlanCacheManager writeNeutronPort Port [_allowedAddressPairs=[], _deviceId=dhcp639d7107-1693-5abe-bb94-18ba198147ec-21e67093-9cf3-4172-9943-64fca7be2da5, _deviceOwner=network:dhcp, _extraDhcpOpts=[], _fixedIps=[FixedIps [_ipAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]], _key=FixedIpsKey [_subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], _ipAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]]], _subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], augmentation=[]]], _key=PortKey [_uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]], _macAddress=MacAddress [_value=fa:16:3e:d8:2c:da], _name=, _networkId=Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5], _revisionNumber=7, _securityGroups=[], _tenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], _uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9], _adminStateUp=true, augmentation=[PortBindingExtension [_hostId=jw-controller, _vifDetails=[VifDetails [_detailsKey=has_datapath_type_netdev, _key=VifDetailsKey [_detailsKey=has_datapath_type_netdev], _value=false, augmentation=[]], VifDetails [_detailsKey=uuid, _key=VifDetailsKey [_detailsKey=uuid], _value=dc328b61-430d-4d06-a432-a9e3afc9660a, augmentation=[]], VifDetails [_detailsKey=support_vhost_user, _key=VifDetailsKey [_detailsKey=support_vhost_user], _value=false, augmentation=[]]], _vifType=ovs, _vnicType=normal], PortSecurityExtension [_portSecurityEnabled=false]]]
IceVlanCacheManager vlanPortMap &#xFF1A;ADD Port [_allowedAddressPairs=[], _deviceId=dhcp639d7107-1693-5abe-bb94-18ba198147ec-21e67093-9cf3-4172-9943-64fca7be2da5, _deviceOwner=network:dhcp, _extraDhcpOpts=[], _fixedIps=[FixedIps [_ipAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]], _key=FixedIpsKey [_subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], _ipAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]]], _subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], augmentation=[]]], _key=PortKey [_uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]], _macAddress=MacAddress [_value=fa:16:3e:d8:2c:da], _name=, _networkId=Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5], _revisionNumber=7, _securityGroups=[], _tenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], _uuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9], _adminStateUp=true, augmentation=[PortBindingExtension [_hostId=jw-controller, _vifDetails=[VifDetails [_detailsKey=has_datapath_type_netdev, _key=VifDetailsKey [_detailsKey=has_datapath_type_netdev], _value=false, augmentation=[]], VifDetails [_detailsKey=uuid, _key=VifDetailsKey [_detailsKey=uuid], _value=dc328b61-430d-4d06-a432-a9e3afc9660a, augmentation=[]], VifDetails [_detailsKey=support_vhost_user, _key=VifDetailsKey [_detailsKey=support_vhost_user], _value=false, augmentation=[]]], _vifType=ovs, _vnicType=normal], PortSecurityExtension [_portSecurityEnabled=false]]] failed
NeutronPortChangeListener NeutronPortChangeListener data tree changed.
NeutronPortChangeListener NeutronPortChangeListener data tree changed write.
netvirt.neutronvpn.NeutronPortChangeListener Update port 85617daf-4a17-49c0-a3a2-9841625aa5c9 from network Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5]
netvirt.neutronvpn.NeutronPortChangeListener Update port 85617daf-4a17-49c0-a3a2-9841625aa5c9 from network Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5]
IceNeutronPortChangeListener IceNeutronPortChangeListener data tree changed.
IceNeutronPortChangeListener IcePort data tree changed.
before IcePort{getDeviceId=dhcp639d7107-1693-5abe-bb94-18ba198147ec-21e67093-9cf3-4172-9943-64fca7be2da5, getDeviceOwner=network:dhcp, getIceAllowedAddressPairs=[], getIceExtraDhcpOpts=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:d8:2c:da], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getRevisionNumber=7, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9], isAdminStateUp=true, augmentations={interface yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=jw-controller, getIceVifDetails=[IceVifDetails{getDetailsKey=has_datapath_type_netdev, getValue=false, augmentations={}}, IceVifDetails{getDetailsKey=uuid, getValue=dc328b61-430d-4d06-a432-a9e3afc9660a, augmentations={}}, IceVifDetails{getDetailsKey=support_vhost_user, getValue=false, augmentations={}}], getVifType=ovs, getVnicType=normal}, interface yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}
 after IcePort{getDeviceId=dhcp639d7107-1693-5abe-bb94-18ba198147ec-21e67093-9cf3-4172-9943-64fca7be2da5, getDeviceOwner=network:dhcp, getIceAllowedAddressPairs=[], getIceExtraDhcpOpts=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.2]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:d8:2c:da], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getRevisionNumber=8, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9], isAdminStateUp=true, augmentations={interface yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=jw-controller, getIceVifDetails=[IceVifDetails{getDetailsKey=has_datapath_type_netdev, getValue=false, augmentations={}}, IceVifDetails{getDetailsKey=uuid, getValue=dc328b61-430d-4d06-a432-a9e3afc9660a, augmentations={}}, IceVifDetails{getDetailsKey=support_vhost_user, getValue=false, augmentations={}}], getVifType=ovs, getVnicType=normal}, interface yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}

</code></pre><p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>interface Ethernet1/1
  switchport mode trunk
  switchport trunk allowed vlan 2
</code></pre><p><strong>&#x547D;&#x4EE4;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;vlan  2 ;interface Ethernet1/1 ;switchport  ;switchport mode trunk ;switchport trunk allowed vlan  2 ;no shutdown

</code></pre><h3 class="mume-header" id="13-%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1">1.3. &#x521B;&#x5EFA;&#x8DEF;&#x7531;</h3>

<p><strong>&#x65E5;&#x5FD7;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>#### neutron &#x76D1;&#x542C;&#x5230;&#x8DEF;&#x7531;&#x5668;&#x521B;&#x5EFA; ####
IceNeutronRouterChangeListener IceNeutronRouterChangeListener data tree changed.
IceNeutronRouterChangeListener WRITE IceRouter IceNeutronRouterChangeListener
IceNeutronRouterChangeListener Adding IceRouter : value=IceRouter{getIceRoutes=[], getName=router, getProjectId=baec961077ea4e67933a8c140ca444d1, getRevisionNumber=1, getStatus=ACTIVE, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], isAdminStateUp=true, isDistributed=false, augmentations={}}

#### &#x5206;&#x914D;vlan vxlan id ####
com.inspur.ice.impl.overlay.IceOverlayPoolsManager Allocate id: 11500 ,poolType :4
com.inspur.ice.impl.overlay.IceOverlayPoolsManager Allocate id: 2500 ,poolType :2

#### overlay mapper &#x4ECB;&#x5165;&#xFF0C;&#x5199;vxlan L3 ####
IceNeutronUtils serverLeafSet:[Uri [_value=iceDeviceId:172.20.1.177], Uri [_value=iceDeviceId:172.20.1.174]]
IceVxlanCacheManager writeL3Vxlan IceDeviceVxlanL3 [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], _iceExtGateways=[], _iceRouterSubnet=[], _iceVlanId=IceVlanId [_value=2500], _iceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], _iceVpnType=Router, _iceVrfRoute=[], _iceVxlanId=IceVxlanId [_value=11500], _key=IceDeviceVxlanL3Key [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], _iceVxlanId=IceVxlanId [_value=11500]], _distributed=true, augmentation=[]] create true
IceVxlanCacheManager writeL3Vxlan IceDeviceVxlanL3 [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], _iceExtGateways=[], _iceRouterSubnet=[], _iceVlanId=IceVlanId [_value=2500], _iceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], _iceVpnType=Router, _iceVrfRoute=[], _iceVxlanId=IceVxlanId [_value=11500], _key=IceDeviceVxlanL3Key [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], _iceVxlanId=IceVxlanId [_value=11500]], _distributed=true, augmentation=[]] create true

#### overlay config &#x4ECB;&#x5165;&#xFF0C;&#x76D1;&#x542C;&#x5230;vxlan L3&#x53D8;&#x5316;&#xFF0C;&#x51C6;&#x5907;&#x4E0B;&#x53D1;&#x914D;&#x7F6E; ####
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener IceVxlanL3ChangeListener Write - before : null after : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], getIceExtGateways=[], getIceRouterSubnet=[], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}}
com.inspur.ice.overlayconfig.impl.DistributeConfig distribute l3 vxlan config input VxlanConfigl3Input [_configType=Config, _deviceIp=Ipv4Address [_value=172.20.1.177], _routerId=de55a13c-2352-4dd6-b418-3cec4b149890, _vlanId=2500, _vni=VniRange [_value=11500], _vrfContext=de55a13c-23:11500, augmentation=[]]
com.inspur.ice.overlayconfig.impl.ConfigCache init vrf : 11500 for device : iceDeviceId:172.20.1.177
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.177, deviceType=CN61108TC-V

#### underlay &#x4ECB;&#x5165; &#xFF0C;&#x4E0B;&#x53D1;&#x7B2C;&#x4E00;&#x6761;&#x914D;&#x7F6E; ####
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;vlan 2500 ;no vn-segment ;vn-segment 11500 ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;body&quot;: &quot;Warning: Enable double-wide arp-ether tcam carving if igmp snooping/Hsrp over vxlan is enabled. Ignore if tcam carving is already configured.\n&quot;, &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot; }] } }}
com.inspur.ice.impl.devices.config.vlan.Vlan configVlanVnSegment sendCommands return :true
com.inspur.ice.impl.devices.config.vlan.Vlan vlan is not created, so create vlan!
IceLeafSwitchChangeListener LeafSwitch before:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.177], getDevIpAdd=Ipv4Address [_value=172.20.1.177], getDevLocation=, getDevManu=Inspur, getDevName=server177, getDevType=CN61108TC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=96, getPointY=45, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} after:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.177], getDevIpAdd=Ipv4Address [_value=172.20.1.177], getDevLocation=, getDevManu=Inspur, getDevName=server177, getDevType=CN61108TC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500,2500, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=96, getPointY=45, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} data tree changed write.
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config nve1L3Multicast result=true
com.inspur.ice.impl.devices.config.vxlan.VrfContext config vrf start
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.177, deviceType=CN61108TC-V

#### underlay &#x4ECB;&#x5165; &#xFF0C;&#x4E0B;&#x53D1;&#x7B2C;&#x4E8C;&#x6761;&#x914D;&#x7F6E; ####
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;vrf context de55a13c-23:11500 ;vni 11500 ;rd auto ;address-family ipv4 unicast ;route-target both auto ;route-target both auto evpn ;address-family ipv6 unicast ;route-target both auto ;route-target both auto evpn ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}

#### netvirt &#x848B;&#x5A77;&#x5230;router&#x521B;&#x5EFA; ####
org.opendaylight.netvirt.ipv6service.NeutronRouterChangeListener Add Router notification handler is invoked Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890].
org.opendaylight.netvirt.ipv6service.IfMgr No unprocessed interfaces for the router Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890]
com.inspur.ice.impl.devices.config.vxlan.VrfContext Succeed to mergeVrfRouteTargetList, routeTargetList is :RouteTargetList [_key=RouteTargetListKey [_routeTarget=Both, _routeTargetSourceNN=, _routeTargetDestNN=], _routeTarget=Both, _routeTargetDestNN=, _routeTargetSourceNN=, augmentation=[]]
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config VrfContextL3Multicast result=true
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.177, deviceType=CN61108TC-V

#### genius &#x4ECB;&#x5165; &#xFF0C;&#x5206;&#x914D;id ####
org.opendaylight.genius.idmanager.IdManager Got pool IdLocalPool [poolName=vpnservices.2130706689, availableIds=AvailableIdHolder [low=100000, high=102999, cur=99999], releasedIds=ReleasedIdHolder [availableIdCount=0, timeDelaySec=30, delayedEntries=[]]]
org.opendaylight.genius.idmanager.IdManager The newIdValues [100000] for the idKey de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnInstanceListener VPN-ADD: addVpnInstance: VPN Id 100000 generated for VpnInstanceName de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.genius.idmanager.jobs.UpdateIdEntryJob Updated id entry with idValues [100000], idKey de55a13c-2352-4dd6-b418-3cec4b149890, pool vpnservices.2130706689
org.opendaylight.netvirt.vpnmanager.VpnInstanceListener VPN-ADD: addVpnInstance: VpnInstanceOpData populated successfully for vpn de55a13c-2352-4dd6-b418-3cec4b149890 rd de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager processSavedInterfaces: No interfaces in queue for VPN de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnInstanceListener$PostAddVpnInstanceWorker VPN-ADD: onSuccess: Vpn Instance Op Data addition for de55a13c-2352-4dd6-b418-3cec4b149890 successful.

#### underlay &#x4ECB;&#x5165; &#xFF0C;&#x4E0B;&#x53D1;&#x7B2C;&#x4E09;&#x6761;&#x914D;&#x7F6E; ####
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature interface-vlan ;vlan 2500 ;interface vlan 2500 ;no shutdown ;vrf member de55a13c-23:11500 ;ip forward
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;body&quot;: &quot;Warning: Deleted all L3 config on interface Vlan2500\n&quot;, &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot; }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vlan.Vlan interfaceVlanVrf sendCommands return :true
com.inspur.ice.impl.devices.config.vlan.Vlan vlan 2500 is created in device 172.20.1.177, do nothing!
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config InterfaceVlanMulticast result=true
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.177, deviceType=CN61108TC-V
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;interface nve1 ;member vni 11500 associate-vrf ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vxlan.Nve1Config save nve1 id of 172.20.1.177 succeeded
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config Nve1L3Multicast result=true
com.inspur.ice.impl.devices.config.vxlan.L3Config successed to mergeRouterIdWithVrfContext, deviceIp is :Ipv4Address [_value=172.20.1.177]
com.inspur.ice.overlayconfig.impl.DistributeConfig distribute vrfRoutingInstanceConfig input VrfRoutingInstanceConfigInput [_configType=Config, _deviceIp=Ipv4Address [_value=172.20.1.177], _vrfContext=de55a13c-23:11500, _notCheckDeviceRoute=false, augmentation=[]]
com.inspur.ice.impl.devices.config.bgp.BorderLeafConfig device do not config router bgp, deviceIp is :172.20.1.177
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD RouteTable
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener IceVxlanL3ChangeListener Write - before : null after : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], getIceExtGateways=[], getIceRouterSubnet=[], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}}
com.inspur.ice.overlayconfig.impl.DistributeConfig distribute l3 vxlan config input VxlanConfigl3Input [_configType=Config, _deviceIp=Ipv4Address [_value=172.20.1.174], _routerId=de55a13c-2352-4dd6-b418-3cec4b149890, _vlanId=2500, _vni=VniRange [_value=11500], _vrfContext=de55a13c-23:11500, augmentation=[]]
com.inspur.ice.overlayconfig.impl.ConfigCache init vrf : 11500 for device : iceDeviceId:172.20.1.174
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.174, deviceType=CN61108PC-V
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;vlan 2500 ;no vn-segment ;vn-segment 11500 ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;body&quot;: &quot;Warning: Enable double-wide arp-ether tcam carving if igmp snooping/Hsrp over vxlan is enabled. Ignore if tcam carving is already configured.\n&quot;, &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot; }] } }}
com.inspur.ice.impl.devices.config.vlan.Vlan configVlanVnSegment sendCommands return :true
com.inspur.ice.impl.devices.config.vlan.Vlan vlan is not created, so create vlan!
IceLeafSwitchChangeListener LeafSwitch before:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.174], getDevIpAdd=Ipv4Address [_value=172.20.1.174], getDevLocation=, getDevManu=Inspur, getDevName=server174, getDevType=CN61108PC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500-501, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=255, getPointY=246, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} after:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.174], getDevIpAdd=Ipv4Address [_value=172.20.1.174], getDevLocation=, getDevManu=Inspur, getDevName=server174, getDevType=CN61108PC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500-501,2500, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=255, getPointY=246, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} data tree changed write.
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config nve1L3Multicast result=true
com.inspur.ice.impl.devices.config.vxlan.VrfContext config vrf start
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.174, deviceType=CN61108PC-V
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;vrf context de55a13c-23:11500 ;vni 11500 ;rd auto ;address-family ipv4 unicast ;route-target both auto ;route-target both auto evpn ;address-family ipv6 unicast ;route-target both auto ;route-target both auto evpn ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vxlan.VrfContext Succeed to mergeVrfRouteTargetList, routeTargetList is :RouteTargetList [_key=RouteTargetListKey [_routeTarget=Both, _routeTargetSourceNN=, _routeTargetDestNN=], _routeTarget=Both, _routeTargetDestNN=, _routeTargetSourceNN=, augmentation=[]]
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config VrfContextL3Multicast result=true
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.174, deviceType=CN61108PC-V
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;feature interface-vlan ;vlan 2500 ;interface vlan 2500 ;no shutdown ;vrf member de55a13c-23:11500 ;ip forward
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;body&quot;: &quot;Warning: Deleted all L3 config on interface Vlan2500\n&quot;, &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot; }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vlan.Vlan interfaceVlanVrf sendCommands return :true
com.inspur.ice.impl.devices.config.vlan.Vlan vlan 2500 is created in device 172.20.1.174, do nothing!
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config InterfaceVlanMulticast result=true
com.inspur.ice.impl.common.DevInfo deviceIp=172.20.1.174, deviceType=CN61108PC-V
com.inspur.ice.impl.HttpPostCmd devIpAdd is :172.20.1.174 and nxapi commands: config terminal ;interface nve1 ;member vni 11500 associate-vrf ;end
com.inspur.ice.impl.HttpPostCmd nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vxlan.Nve1Config save nve1 id of 172.20.1.174 succeeded
com.inspur.ice.impl.devices.config.vxlan.VxlanManager config Nve1L3Multicast result=true
com.inspur.ice.impl.devices.config.vxlan.L3Config successed to mergeRouterIdWithVrfContext, deviceIp is :Ipv4Address [_value=172.20.1.174]
com.inspur.ice.overlayconfig.impl.DistributeConfig distribute vrfRoutingInstanceConfig input VrfRoutingInstanceConfigInput [_configType=Config, _deviceIp=Ipv4Address [_value=172.20.1.174], _vrfContext=de55a13c-23:11500, _notCheckDeviceRoute=false, augmentation=[]]
com.inspur.ice.impl.devices.config.bgp.BorderLeafConfig device do not config router bgp, deviceIp is :172.20.1.174
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener ADD RouteTable

</code></pre><p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>vlan 2002
  vn-segment 11002

vrf context 1b58fa19-02:11002
  vni 11002
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn


interface Vlan2002
  no shutdown
  vrf member 1b58fa19-02:11002
  ip forward

interface nve1
  member vni 11002 associate-vrf


router bgp 65101
vrf context 1b58fa19-02:11002
  rd auto
  address-family ipv4 unicast
    route-target both auto
    route-target both auto evpn
  address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn

IP Route Table for VRF &quot;1b58fa19-02:11002&quot;
&apos;*&apos; denotes best ucast next-hop
&apos;**&apos; denotes best mcast next-hop
&apos;[x/y]&apos; denotes [preference/metric]
&apos;%&lt;string&gt;&apos; in via output denotes VRF &lt;string&gt;

</code></pre><p><strong>&#x547D;&#x4EE4;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;vlan 2002 ;no vn-segment ;vn-segment 11002 ;end

devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;vrf context 1b58fa19-02:11002 ;vni 11002 ;rd auto ;address-family ipv4 unicast ;route-target both auto ;route-target both auto evpn ;address-family ipv6 unicast ;route-target both auto ;route-target both auto evpn ;end

devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature interface-vlan ;vlan 2002 ;interface vlan 2002 ;no shutdown ;vrf member 1b58fa19-02:11002 ;ip forward

devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;interface nve1 ;member vni 11002 associate-vrf ;end

 devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;router bgp 65101 ;vrf 1b58fa19-02:11002 ;address-family ipv6 unicast ;advertise l2vpn evpn ;redistribute direct route-map all ;address-family ipv4 unicast ;advertise l2vpn evpn ;redistribute direct route-map all

</code></pre><h3 class="mume-header" id="14-%E8%B7%AF%E7%94%B1%E5%99%A8%E6%B7%BB%E5%8A%A0%E6%8E%A5%E5%8F%A3">1.4. &#x8DEF;&#x7531;&#x5668;&#x6DFB;&#x52A0;&#x63A5;&#x53E3;</h3>

<p><strong>&#x65E5;&#x5FD7;&#x5206;&#x6790;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>#### port &#x521B;&#x5EFA; ####
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      IceNeutronPortChangeListener data tree changed.
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      IcePort data tree changed.
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      WRITE
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      Adding Port : value=IcePort{getDeviceId=de55a13c-2352-4dd6-b418-3cec4b149890, getDeviceOwner=network:router_interface, getIceAllowedAddressPairs=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:70:03:a0], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getProjectId=baec961077ea4e67933a8c140ca444d1, getStatus=ACTIVE, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439], isAdminStateUp=true, augmentations={interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=, getIceVifDetails=[], getVifType=unbound, getVnicType=normal}, interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      IcePort{getDeviceId=de55a13c-2352-4dd6-b418-3cec4b149890, getDeviceOwner=network:router_interface, getIceAllowedAddressPairs=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:70:03:a0], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getProjectId=baec961077ea4e67933a8c140ca444d1, getStatus=ACTIVE, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439], isAdminStateUp=true, augmentations={interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=, getIceVifDetails=[], getVifType=unbound, getVnicType=normal}, interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}  router interface created.

#### &#x5199;vxlan L3 subnet &#x4E0B;&#x7684;interface ####
com.inspur.ice.overlaymapper.impl.IceVxlanCacheManager      writeIceRouterSubnet IceRouterSubnet [_cidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], _iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _key=IceRouterSubnetKey [_iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]]], augmentation=[]]
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      IceVxlanL3ChangeListener Write - before : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], getIceExtGateways=[], getIceRouterSubnet=[], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}} after : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], getIceExtGateways=[], getIceRouterSubnet=[IceRouterSubnet{getCidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], getGatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}}
com.inspur.ice.overlayconfig.impl.ConfigCache      ADD IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], getIceExtGateways=[], getIceRouterSubnet=[IceRouterSubnet{getCidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], getGatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}} failed with {}
com.inspur.ice.overlaymapper.impl.IceNeutronvpnUtils      Get subnetmap : Subnetmap{getId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], getNetworkId=Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5], getNetworkType=VLAN, getPortList=[Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]], getSegmentationId=500, getSubnetIp=100.100.1.0/24, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], augmentations={}}
com.inspur.ice.overlayconfig.impl.ConfigCache      init l3 vxlan : IceDeviceVxlanL3Key [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.177], _iceVxlanId=IceVxlanId [_value=11500]] : IceRouterSubnetKey [_iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]]]
com.inspur.ice.overlayconfig.impl.DistributeConfig      distribute interface vlan config input InterfaceVlanVrfMemberInput [_configVlanType=Config, _deviceIp=Ipv4Address [_value=172.20.1.177], _fabricForwarding=AnycastGateway, _vlanId=500, _vlanIp=100.100.1.1/24, _vrfMember=de55a13c-23:11500, _secondaryIp=true, augmentation=[]]
com.inspur.ice.overlaymapper.impl.IceVlanCacheManager      writeL3VpnInterface VpnInterface [_key=VpnInterfaceKey [_name=85617daf-4a17-49c0-a3a2-9841625aa5c9], _name=85617daf-4a17-49c0-a3a2-9841625aa5c9, _vpnInstanceName=de55a13c-2352-4dd6-b418-3cec4b149890, _routerInterface=false, augmentation=[Adjacencies [_adjacency=[Adjacency [_adjacencyType=PrimaryAdjacency, _ipAddress=100.100.1.2, _key=AdjacencyKey [_ipAddress=100.100.1.2], _macAddress=fa:16:3e:d8:2c:da, _subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], augmentation=[]]]]]]
com.inspur.ice.overlaymapper.impl.IceVxlanCacheManager      writeIceRouterSubnet IceRouterSubnet [_cidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], _iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _key=IceRouterSubnetKey [_iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]]], augmentation=[]]
com.inspur.ice.overlaymapper.impl.IceNeutronvpnUtils      Get subnetmap : Subnetmap{getId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], getNetworkId=Uuid [_value=476baec5-fd39-349d-a84e-57c1d2221ec5], getNetworkType=VLAN, getPortList=[Uuid [_value=85617daf-4a17-49c0-a3a2-9841625aa5c9]], getSegmentationId=500, getSubnetIp=100.100.1.0/24, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], augmentations={}}
com.inspur.ice.overlaymapper.impl.IceVlanCacheManager      writeL3VpnInterface VpnInterface [_key=VpnInterfaceKey [_name=85617daf-4a17-49c0-a3a2-9841625aa5c9], _name=85617daf-4a17-49c0-a3a2-9841625aa5c9, _vpnInstanceName=de55a13c-2352-4dd6-b418-3cec4b149890, _routerInterface=false, augmentation=[Adjacencies [_adjacency=[Adjacency [_adjacencyType=PrimaryAdjacency, _ipAddress=100.100.1.2, _key=AdjacencyKey [_ipAddress=100.100.1.2], _macAddress=fa:16:3e:d8:2c:da, _subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], augmentation=[]]]]]]
com.inspur.ice.overlaymapper.impl.NeutronL3VpnInterfaceListener      NeutronL3VpnInterfaceListener add  recieve !!!
com.inspur.ice.overlaymapper.impl.IceVlanCacheManager      vpnPortMap &#xFF1A;ADD VpnInterface [_key=VpnInterfaceKey [_name=85617daf-4a17-49c0-a3a2-9841625aa5c9], _name=85617daf-4a17-49c0-a3a2-9841625aa5c9, _vpnInstanceName=de55a13c-2352-4dd6-b418-3cec4b149890, _routerInterface=false, augmentation=[Adjacencies [_adjacency=[Adjacency [_adjacencyType=PrimaryAdjacency, _ipAddress=100.100.1.2, _key=AdjacencyKey [_ipAddress=100.100.1.2], _macAddress=fa:16:3e:d8:2c:da, _subnetId=Uuid [_value=49c27f08-05d1-3f62-a810-91a6f700856a], augmentation=[]]]]]] failed
com.inspur.ice.overlaymapper.impl.NeutronCommonUtils      IceFwconnectionrouters is null!!!
com.inspur.ice.overlaymapper.impl.NeutronL3VpnInterfaceListener      NeutronL3VpnInterfaceListener iceFwconnectionrouter  is null !!!
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      add: intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 onto vpnName de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      addVpnInterface: VPN Interface add event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 onto vpnName de55a13c-2352-4dd6-b418-3cec4b149890 from addVpnInterface
com.inspur.ice.overlaymapper.impl.NeutronL3VpnInterfaceListener      NeutronL3VpnInterfaceListener update  recieve !!!
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      update: VPN Interface update event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 on dpn null oldVpn de55a13c-2352-4dd6-b418-3cec4b149890 newVpn de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      addVpnInterface: VPN Interface add event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 vpnName de55a13c-2352-4dd6-b418-3cec4b149890 on dpn null
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      processVpnInterfaceUp: Binding vpn service to interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 onto dpn 115377256237675 for vpn de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnFootprintService      createOrUpdateVpnToDpnList: Created/Updated vpn footprint for vpn de55a13c-2352-4dd6-b418-3cec4b149890 vpnId 100000 interfacName85617daf-4a17-49c0-a3a2-9841625aa5c9 on dpn 115377256237675
org.opendaylight.netvirt.vpnmanager.VpnOpStatusListener      update: Processing update for vpn de55a13c-2352-4dd6-b418-3cec4b149890 with rd de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.fibmanager.VrfEntryListener      populateFibOnNewDpn: dpn: 115377256237675: VRF Table not yet available for RD de55a13c-2352-4dd6-b418-3cec4b149890
org.opendaylight.netvirt.vpnmanager.VpnFootprintService      publishAddNotification: Successful in notifying listeners for add dpn 115377256237675 in vpn de55a13c-2352-4dd6-b418-3cec4b149890 rd de55a13c-2352-4dd6-b418-3cec4b149890 event
org.opendaylight.netvirt.vpnmanager.VpnFootprintService$DpnEnterExitVpnWorker      onSuccess: FootPrint established for vpn de55a13c-2352-4dd6-b418-3cec4b149890 rd de55a13c-2352-4dd6-b418-3cec4b149890 on dpn 115377256237675
org.opendaylight.netvirt.vpnmanager.VpnFootprintService      createOrUpdateVpnToDpnList: Sent populateFib event for new dpn 115377256237675 in VPN de55a13c-2352-4dd6-b418-3cec4b149890 for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9
org.opendaylight.genius.datastoreutils.DataStoreJobCoordinator      Exception when executing jobEntry: JobEntry{key=&apos;VPNINTERFACE-85617daf-4a17-49c0-a3a2-9841625aa5c9&apos;, mainWorker=org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager$$Lambda$741/1527639192@6e597ade, rollbackWorker=null, retryCount=0, futures=null}
java.lang.NullPointerException: null
        at org.opendaylight.netvirt.vpnmanager.VpnUtil.getVpnSubnetGatewayIp(VpnUtil.java:1464) ~[395:org.opendaylight.netvirt.vpnmanager-impl:0.5.2]
        at org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager.processVpnInterfaceAdjacencies(VpnInterfaceManager.java:679) ~[395:org.opendaylight.netvirt.vpnmanager-impl:0.5.2]
        at org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager.processVpnInterfaceUp(VpnInterfaceManager.java:379) ~[395:org.opendaylight.netvirt.vpnmanager-impl:0.5.2]
        at org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager.lambda$addVpnInterface$0(VpnInterfaceManager.java:247) ~[395:org.opendaylight.netvirt.vpnmanager-impl:0.5.2]
        at org.opendaylight.genius.datastoreutils.DataStoreJobCoordinator$MainTask.run(DataStoreJobCoordinator.java:285) [304:org.opendaylight.genius.mdsalutil-api:0.3.2]
        at java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1402) [?:?]
        at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) [?:?]
        at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056) [?:?]
        at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692) [?:?]
        at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) [?:?]
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      VPN Interface update event - intfName 85617daf-4a17-49c0-a3a2-9841625aa5c9 onto vpnName de55a13c-2352-4dd6-b418-3cec4b149890 running config-driven
org.opendaylight.netvirt.vpnmanager.VpnInterfaceManager      update: vpn interface updated for interface 85617daf-4a17-49c0-a3a2-9841625aa5c9 oldVpn de55a13c-2352-4dd6-b418-3cec4b149890 newVpn de55a13c-2352-4dd6-b418-3cec4b149890 processed successfully
com.inspur.ice.impl.common.DevInfo      deviceIp=172.20.1.177, deviceType=CN61108TC-V
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      IceNeutronPortChangeListener data tree changed.
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      IcePort data tree changed.
before IcePort{getDeviceId=de55a13c-2352-4dd6-b418-3cec4b149890, getDeviceOwner=network:router_interface, getIceAllowedAddressPairs=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:70:03:a0], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getProjectId=baec961077ea4e67933a8c140ca444d1, getStatus=ACTIVE, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439], isAdminStateUp=true, augmentations={interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=, getIceVifDetails=[], getVifType=unbound, getVnicType=normal}, interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}
 after IcePort{getDeviceId=de55a13c-2352-4dd6-b418-3cec4b149890, getDeviceOwner=network:router_interface, getIceAllowedAddressPairs=[], getIceExtraDhcpOpts=[], getIceFixedIps=[IceFixedIps{getIpAddress=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceSecurityGroups=[], getMacAddress=MacAddress [_value=fa:16:3e:70:03:a0], getName=, getNetworkId=Uuid [_value=21e67093-9cf3-4172-9943-64fca7be2da5], getRevisionNumber=5, getTenantId=Uuid [_value=baec9610-77ea-4e67-933a-8c140ca444d1], getUuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439], isAdminStateUp=true, augmentations={interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.binding.rev180302.IcePortBindingExtension=IcePortBindingExtension{getHostId=, getIceVifDetails=[], getVifType=unbound, getVnicType=normal}, interface org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.ice.neutron.portsecurity.rev150712.IcePortSecurityExtension=IcePortSecurityExtension{isPortSecurityEnabled=false}}}
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      WRITE
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      Updating Port : original = IcePortKey [_uuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439]] update = IcePortKey [_uuid=Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439]]
com.inspur.ice.overlaymapper.impl.IceNeutronPortChangeListener      Search port failed from neutron data store Uuid [_value=562cd511-c923-44b1-993a-ed3647e02439]
com.inspur.ice.impl.HttpPostCmd      devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature interface-vlan ;vlan 500 ;interface vlan 500 ;no shutdown ;vrf member de55a13c-23:11500 ;no ip forward ;ip address 100.100.1.1/24 ;fabric forwarding mode anycast-gateway
com.inspur.ice.impl.HttpPostCmd      nxapi return is: { &quot;ins_api&quot;: { &quot;sid&quot;: &quot;eoc&quot;, &quot;type&quot;: &quot;cli_conf&quot;, &quot;version&quot;: &quot;1.0&quot;, &quot;outputs&quot;: { &quot;output&quot;: [{ &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;body&quot;: &quot;Warning: Deleted all L3 config on interface Vlan500\n&quot;, &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot; }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }, { &quot;code&quot;: &quot;200&quot;, &quot;msg&quot;: &quot;Success&quot;, &quot;body&quot;: { } }] } }}
com.inspur.ice.impl.devices.config.vlan.Vlan      interfaceVlanVrf sendCommands return :true
com.inspur.ice.impl.devices.config.vlan.Vlan      vlan is not created, so create vlan!
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ArpNotification Gratuitous Request Received from interface 115377256237675:ens192:500 and IP 100.100.1.1 having MAC 00:01:00:01:00:01 target destination 100.100.1.1, learning MAC
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ARP NO_RESOLVE: VPN  not configured. Ignoring responding to ARP requests from this Interface 115377256237675:ens192:500.
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ArpNotification Gratuitous Request Received from interface 115377256237675:ens192:500 and IP 100.100.1.1 having MAC 00:01:00:01:00:01 target destination 100.100.1.1, learning MAC
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ARP NO_RESOLVE: VPN  not configured. Ignoring responding to ARP requests from this Interface 115377256237675:ens192:500.
com.inspur.ice.overlaymapper.impl.IceLeafSwitchChangeListener      LeafSwitch before:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.177], getDevIpAdd=Ipv4Address [_value=172.20.1.177], getDevLocation=, getDevManu=Inspur, getDevName=server177, getDevType=CN61108TC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500,2500, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=96, getPointY=45, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} after:Switch{getDevDesc=ICNT NOS-CN(tm) inos, Software (inos-cn), Version 9.2(2), RELEASE SOFTWARE Copyright (c) 2016-2018, Used subject to license from copyright owner. Compiled 11/8/2018 7:00:00, getDevId=Uri [_value=iceDeviceId:172.20.1.177], getDevIpAdd=Ipv4Address [_value=172.20.1.177], getDevLocation=, getDevManu=Inspur, getDevName=server177, getDevType=CN61108TC-V, getDeviceRole=ServerLeaf, getDeviceVlanId=1,500,2500, getEnablePassword=inspur@123, getEvpnTemp=1, getMacAddress=00:00:00:00, getOnlineStatus=onLine, getPointX=96, getPointY=45, getSnmpRead=public, getSnmpVersion=v2c, getSnmpWrite=public, getSshPassword=inspur@123, getSshUserName=admin, getSyncStatus=sync, isHasFex=false, augmentations={}} data tree changed write.
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      REMOVE VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      UPDATE RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD RouteTable
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      REMOVE RouteTable
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      IceVxlanL3ChangeListener Write - before : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], getIceExtGateways=[], getIceRouterSubnet=[IceRouterSubnet{getCidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], getGatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}} after : IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], getIceExtGateways=[], getIceRouterSubnet=[IceRouterSubnet{getCidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], getGatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}}
com.inspur.ice.overlayconfig.impl.ConfigCache      ADD IceDeviceVxlanL3{getIceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], getIceExtGateways=[], getIceRouterSubnet=[IceRouterSubnet{getCidr=IpPrefix [_ipv4Prefix=Ipv4Prefix [_value=100.100.1.0/24]], getGatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]], getIceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], augmentations={}}], getIceVlanId=IceVlanId [_value=2500], getIceVpnId=Uuid [_value=de55a13c-2352-4dd6-b418-3cec4b149890], getIceVpnType=Router, getIceVrfRoute=[], getIceVxlanId=IceVxlanId [_value=11500], isDistributed=true, augmentations={}} failed with {}
com.inspur.ice.overlayconfig.impl.ConfigCache      ADD IceRouterSubnetKey [_iceSubnetId=Uuid [_value=08617069-adb2-476c-90e9-b6bb4f425091], _gatewayIp=IpAddress [_ipv4Address=Ipv4Address [_value=100.100.1.1]]] failed with IceDeviceVxlanL3Key [_iceDeviceId=Uri [_value=iceDeviceId:172.20.1.174], _iceVxlanId=IceVxlanId [_value=11500]]
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      REMOVE VrfRoute
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      UPDATE RouteGateway
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      ADD RouteTable
com.inspur.ice.overlayconfig.impl.IceVxlanL3ChangeListener      REMOVE RouteTable
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ArpNotification Gratuitous Request Received from interface 115377256237675:ens192:500 and IP 100.100.1.1 having MAC 00:01:00:01:00:01 target destination 100.100.1.1, learning MAC
org.opendaylight.netvirt.vpnmanager.ArpNotificationHandler      ARP NO_RESOLVE: VPN  not configured. Ignoring responding to ARP requests from this Interface 115377256237675:ens192:500.

</code></pre><p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code> &#x6DFB;&#x52A0;&#x5230;&#x8DEF;&#x7531;

 interface Vlan2
  no shutdown
  vrf member 1b58fa19-02:11002
  ip address 10.10.10.1/24
  fabric forwarding mode anycast-gateway
</code></pre><p><strong>&#x547D;&#x4EE4;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code> devIpAdd is :172.20.1.177 and nxapi commands: config terminal ;feature interface-vlan ;vlan 2 ;interface vlan 2 ;no shutdown ;vrf member 1b58fa19-02:11002 ;no ip forward ;ip address 10.10.10.1/24 ;fabric forwarding mode anycast-gateway

</code></pre><h1 class="mume-header" id="%E6%B7%BB%E5%8A%A0%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1">&#x6DFB;&#x52A0;&#x9759;&#x6001;&#x8DEF;&#x7531;</h1>

<p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>vrf context vni-11001
  vni 11001
  rd auto
  ip route 10.0.0.0/24 99.99.99.2 &#x76EE;&#x7684;&#x7F51;&#x6BB5;/&#x4E0B;&#x4E00;&#x8DF3;
  address-family ipv4 unicast
    route-target both auto
route-target both auto evpn
address-family ipv6 unicast
    route-target both auto
    route-target both auto evpn

&#x5728;BGP&#x4E2D;&#x53D1;&#x5E03;&#xFF08;underlay bgpvrf&#xFF09;
router bgp 65101
  vrf vni-11001
  address-family ipv4 unicast
    network 10.0.0.0/24  /&#x4E0B;&#x4E00;&#x8DF3;

</code></pre><h1 class="mume-header" id="%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1">&#x52A8;&#x6001;&#x8DEF;&#x7531;</h1>

<p><strong>&#x4EA4;&#x6362;&#x673A;&#x914D;&#x7F6E;</strong></p>
<pre data-role="codeBlock" data-info class="language-"><code>------underlay bgpVrfNeighborConfig
router bgp 65101
  vrf vni-11001
    address-family ipv4 unicast
      advertise l2vpn evpn
    neighbor 99.99.99.2 remote-as 200
      address-family ipv4 unicast 

</code></pre><h2 class="mume-header" id="2-%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E">2. &#x5E38;&#x7528;&#x63A5;&#x53E3;&#x8BF4;&#x660E;</h2>

<h3 class="mume-header" id="21-overlay">2.1. overlay</h3>

<p><strong>distributeL2VxlanConfig --&gt; vxlanConfigl2Dynamic</strong></p>
<p>&quot; config terminal ;feature nv overlay  ;feature vn-segment-vlan-based  ;nv overlay evpn  ;evpn ;vni 10071 l2 ;rd auto ;route-target import auto ;route-target export auto ;exit&quot;</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>