---
title: ovs常用命令
date: 2019-08-22 17:09:22 
categories:
- 框架
- openvswitch
tags: 
- openvswitch
description: ovs常用命令
export_on_save:
    html: true
html:
  embed_local_images: false
  embed_svg: true
  offline: false
  toc: false
  
---
<!DOCTYPE html><html><head>
      <title>ovs&#x5E38;&#x7528;&#x547D;&#x4EE4;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css">
      
      

      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h2 class="mume-header" id="1-ovs%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">1. ovs&#x5E38;&#x7528;&#x547D;&#x4EE4;</h2>

<h3 class="mume-header" id="11-%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BA">1.1. &#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;</h3>

<table>
<thead>
<tr>
<th>&#x4ECB;&#x7ECD;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;&#x5B9E;&#x4F8B;</td>
<td>virsh list</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;xml</td>
<td>virsh dumpxml instance-00000038</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;&#x540D;&#x79F0;</td>
<td>virsh dumpxml instance-00000038</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x865A;&#x62DF;&#x673A;&#x5BF9;&#x5E94;tab&#x53E3;</td>
<td>virsh dumpxml instance-00000038</td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="12-%E6%8E%A7%E5%88%B6%E7%AE%A1%E7%90%86%E7%B1%BB">1.2. &#x63A7;&#x5236;&#x7BA1;&#x7406;&#x7C7B;</h3>

<p>1.&#x67E5;&#x770B;&#x7F51;&#x6865;&#x548C;&#x7AEF;&#x53E3;</p>
<p><code>ovs-vsctl show</code></p>
<p>2.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7F51;&#x6865;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">    ovs-vsctl add-br br0
    ovs-vsctl <span class="token keyword">set</span> bridge br0 datapath_type<span class="token operator">=</span>netdev
</pre><p>3.&#x6DFB;&#x52A0;/&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">    <span class="token comment"># for system interfaces</span>
    ovs-vsctl add-port br0 eth1
    ovs-vsctl del-port br0 eth1
    <span class="token comment"># for DPDK</span>
    ovs-vsctl add-port br0 dpdk1 -- <span class="token keyword">set</span> interface dpdk1 type<span class="token operator">=</span>dpdk options:dpdk-devargs<span class="token operator">=</span>0000:01:00.0
    <span class="token comment"># for DPDK bonds</span>
    ovs-vsctl add-bond br0 dpdkbond0 dpdk1 dpdk2 \
    -- <span class="token keyword">set</span> interface dpdk1 type<span class="token operator">=</span>dpdk options:dpdk-devargs<span class="token operator">=</span>0000:01:00.0 \
    -- <span class="token keyword">set</span> interface dpdk2 type<span class="token operator">=</span>dpdk options:dpdk-devargs<span class="token operator">=</span>0000:02:00.0
</pre><p>4.&#x8BBE;&#x7F6E;/&#x6E05;&#x9664;&#x7F51;&#x6865;&#x7684;openflow&#x534F;&#x8BAE;&#x7248;&#x672C;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-vsctl <span class="token keyword">set</span> bridge br0 protocols<span class="token operator">=</span>OpenFlow13
ovs-vsctl <span class="token function">clear</span> bridge br0 protocols
</pre><p>5.&#x67E5;&#x770B;&#x67D0;&#x7F51;&#x6865;&#x5F53;&#x524D;&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl dump-flows br0
ovs-ofctl -O OpenFlow13 dump-flows br0
ovs-appctl bridge/dump-flows br0
</pre><p>6.&#x8BBE;&#x7F6E;/&#x5220;&#x9664;&#x63A7;&#x5236;&#x5668;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-vsctl set-controller br0 tcp:1.2.3.4:6633
ovs-vsctl del-controller br0
</pre><p>7.&#x67E5;&#x770B;&#x63A7;&#x5236;&#x5668;&#x5217;&#x8868;(&#x4E3B;&#x52A8;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x4EA4;&#x6362;&#x673A;&#x4E3B;&#x52A8;&#x8FDE;&#x63A5;&#x63A7;&#x5236;&#x5668;)</p>
<p><code>ovs-vsctl list controller</code></p>
<p>8.&#x8BBE;&#x7F6E;/&#x5220;&#x9664;&#x88AB;&#x52A8;&#x8FDE;&#x63A5;&#x63A7;&#x5236;&#x5668;&#xFF08;&#x88AB;&#x52A8;&#x63A7;&#x5236;&#x5668;&#xFF0C;&#x4EA4;&#x6362;&#x673A;&#x88AB;&#x52A8;&#x7B49;&#x5F85;&#x63A7;&#x5236;&#x5668;&#x8FDE;&#x63A5;&#xFF09;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-vsctl set-manager tcp:1.2.3.4:6640
ovs-vsctl get-manager
ovs-vsctl del-manager
</pre><p>9.&#x8BBE;&#x7F6E;/&#x79FB;&#x9664;&#x53EF;&#x9009;&#x9009;&#x9879;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-vsctl <span class="token keyword">set</span> Interface eth0 options:link_speed<span class="token operator">=</span>1G
ovs-vsctl remove Interface eth0 options link_speed
</pre><p>10.&#x8BBE;&#x7F6E;fail&#x6A21;&#x5F0F;&#xFF0C;&#x652F;&#x6301;standalone&#x6216;&#x8005;secure</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">#standalone(default)&#xFF1A;&#x6E05;&#x9664;&#x6240;&#x6709;&#x63A7;&#x5236;&#x5668;&#x4E0B;&#x53D1;&#x7684;&#x6D41;&#x8868;&#xFF0C;ovs&#x81EA;&#x5DF1;&#x63A5;&#x7BA1; </span>
<span class="token comment">#secure&#xFF1A;&#x6309;&#x7167;&#x539F;&#x6765;&#x6D41;&#x8868;&#x7EE7;&#x7EED;&#x8F6C;&#x53D1;</span>
ovs-vsctl del-fail-mode br0
ovs-vsctl set-fail-mode br0 secure
ovs-vsctl get-fail-mode br0&#xFEFF;&#x200B;
</pre><p>11.&#x67E5;&#x770B;&#x63A5;&#x53E3;id&#x7B49;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-appctl dpif/show&#xFEFF;
</pre><p>12.&#x67E5;&#x770B;&#x63A5;&#x53E3;&#x7EDF;&#x8BA1;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl dump-ports br0
</pre><p>13.&#x83B7;&#x5F97;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x7684; OpenFlow &#x7F16;&#x53F7;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-vsctl get Interface tap8f178fef-10 ofport
</pre><p>14.&#x6D41;&#x8868;&#x8DDF;&#x8E2A;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-appctl ofproto/trace br-int in_port<span class="token operator">=</span>5,dl_src<span class="token operator">=</span>fa:16:3e:11:79:65,dl_dst<span class="token operator">=</span>fa:16:3e:1e:35:db,ip,nw_src<span class="token operator">=</span>10.10.10.4,nw_dst<span class="token operator">=</span>10.10.10.6,nw_proto<span class="token operator">=</span>1 -generate
<span class="token comment">#&#x5907;&#x6CE8;&#xFF1A;in_port&#x4E3A;&#x865A;&#x62DF;&#x673A;&#x51FA;&#x7684;tab&#x53E3;,dl_type ping&#x5305;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5199;ip</span>
 
ovs-appctl ofproto/trace br-int in_port<span class="token operator">=</span>5,dl_src<span class="token operator">=</span>fa:16:3e:11:79:65,dl_dst<span class="token operator">=</span>fa:16:3e:1e:35:db,ip,nw_src<span class="token operator">=</span>10.10.10.4,nw_dst<span class="token operator">=</span>10.10.10.6,nw_proto<span class="token operator">=</span>1,recirc_id<span class="token operator">=</span>0x27,ct_state<span class="token operator">=</span>est\<span class="token operator">|</span>trk -generate
<span class="token comment">#ct_state &#x53EA;&#x5199;&#x524D;&#x9762;&#x4E3A;+&#x597D;&#x7684;&#xFF0C;&#x8868;&#x793A;&#x4E3A;true</span>
<span class="token comment">#&#x4F7F;&#x7528;&#x65F6;&#xFF0C;&#x6700;&#x597D;&#x4E00;&#x76F4;ping&#xFF0C; &#x5426;&#x5219;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;Translation failed (No recirculation context), packet is dropped.</span>
<span class="token comment">#http://www.openvswitch.org//support/dist-docs/ovs-vswitchd.8.html</span>
<span class="token comment">#http://docs.openvswitch.org/en/latest/topics/tracing/?highlight=ovs-appctl%20</span>
</pre><p>15.&#x67E5;&#x770B;ip&#x547D;&#x540D;&#x7A7A;&#x95F4;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token function">ip</span> netns list
</pre><p>16.&#x5728;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x6267;&#x884C;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token function">sudo</span> <span class="token function">ip</span> netns <span class="token function">exec</span>  <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">[</span>command<span class="token punctuation">]</span>
</pre><p>&#x6D41;&#x8868;&#x7C7B;</p>
<p>&#x6D41;&#x8868;&#x64CD;&#x4F5C;<br>
1.&#x6DFB;&#x52A0;&#x666E;&#x901A;&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>output:2
</pre><p>2.&#x5220;&#x9664;&#x6240;&#x6709;&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl del-flows br0&#xFEFF;&#x200B;
</pre><p>3.&#x6309;&#x5339;&#x914D;&#x9879;&#x6765;&#x5220;&#x9664;&#x6D41;&#x8868;</p>
<p>bash<br>
ovs-ofctl del-flows br0 &quot;in_port=1&quot;</p>
<pre data-role="codeBlock" data-info class="language-"><code> 

4.&#x67E5;&#x770B;&#x6D41;&#x8868;

```bash
ovs-ofctl [-O openflow13] dump-flows br-int [table=0]
</code></pre><p>&#x5339;&#x914D;&#x9879;</p>
<p>1.&#x5339;&#x914D;vlan tag&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-4095</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 priority<span class="token operator">=</span>401,in_port<span class="token operator">=</span>1,dl_vlan<span class="token operator">=</span>777,actions<span class="token operator">=</span>output:2
</pre><p>2.&#x5339;&#x914D;vlan pcp&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-7</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 priority<span class="token operator">=</span>401,in_port<span class="token operator">=</span>1,dl_vlan_pcp<span class="token operator">=</span>7,actions<span class="token operator">=</span>output:2
</pre><p>3.&#x5339;&#x914D;&#x6E90;/&#x76EE;&#x7684;MAC</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,dl_src<span class="token operator">=</span>00:00:00:00:00:01/00:00:00:00:00:01,actions<span class="token operator">=</span>output:2
ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,dl_dst<span class="token operator">=</span>00:00:00:00:00:01/00:00:00:00:00:01,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>4.&#x5339;&#x914D;&#x4EE5;&#x592A;&#x7F51;&#x7C7B;&#x578B;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-65535</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,dl_type<span class="token operator">=</span>0x0806,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>5.&#x5339;&#x914D;&#x6E90;/&#x76EE;&#x7684;IP<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800&#xFF0C;&#x6216;&#x8005;ip/tcp</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_src<span class="token operator">=</span>10.10.0.0/16,actions<span class="token operator">=</span>output:2
ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_dst<span class="token operator">=</span>10.20.0.0/16,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>6.&#x5339;&#x914D;&#x534F;&#x8BAE;&#x53F7;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800&#x6216;&#x8005;ip</p>
<h2>2. ICMP</h2>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_proto<span class="token operator">=</span>1,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>7.&#x5339;&#x914D;IP ToS/DSCP&#xFF0C;tos&#x8303;&#x56F4;&#x4E3A;0-255&#xFF0C;DSCP&#x8303;&#x56F4;&#x4E3A;0-63<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800/0x86dd&#xFF0C;&#x5E76;&#x4E14;ToS&#x4F4E;2&#x4F4D;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;(DSCP&#x503C;&#x4E3A;ToS&#x7684;&#x9AD8;6&#x4F4D;&#xFF0C;&#x5E76;&#x4E14;&#x4F4E;2&#x4F4D;&#x4E3A;&#x9884;&#x7559;&#x4F4D;)</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_tos<span class="token operator">=</span>68,actions<span class="token operator">=</span>output:2
ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,ip_dscp<span class="token operator">=</span>62,actions<span class="token operator">=</span>output:2
</pre><p>8.&#x5339;&#x914D;IP ecn&#x4F4D;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-3<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800/0x86dd</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,ip_ecn<span class="token operator">=</span>2,actions<span class="token operator">=</span>output:2
</pre><p>9.&#x5339;&#x914D;IP TTL&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_ttl<span class="token operator">=</span>128,actions<span class="token operator">=</span>output:2
</pre><p>10.&#x5339;&#x914D;tcp/udp&#xFF0C;&#x6E90;/&#x76EE;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-65535</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x5339;&#x914D;&#x6E90;tcp&#x7AEF;&#x53E3;179</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;&#x6E90;tcp&#x7AEF;&#x53E3;179&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 tcp,tcp_src<span class="token operator">=</span>179/0xfff0,actions<span class="token operator">=</span>output:2
<span class="token comment">## &#x5339;&#x914D;&#x76EE;&#x7684;tcp&#x7AEF;&#x53E3;179</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;&#x76EE;&#x7684;tcp&#x7AEF;&#x53E3;179&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 tcp,tcp_dst<span class="token operator">=</span>179/0xfff0,actions<span class="token operator">=</span>output:2
<span class="token comment">## &#x5339;&#x914D;&#x6E90;udp&#x7AEF;&#x53E3;1234</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;&#x6E90;udp&#x7AEF;&#x53E3;1234&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 udp,udp_src<span class="token operator">=</span>1234/0xfff0,actions<span class="token operator">=</span>output:2
<span class="token comment">## &#x5339;&#x914D;&#x76EE;&#x7684;udp&#x7AEF;&#x53E3;1234</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;&#x76EE;&#x7684;udp&#x7AEF;&#x53E3;1234&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 udp,udp_dst<span class="token operator">=</span>1234/0xfff0,actions<span class="token operator">=</span>output:2
</pre><p>11.&#x5339;&#x914D;tcp flags<br>
tcp flags=fin&#xFF0C;syn&#xFF0C;rst&#xFF0C;psh&#xFF0C;ack&#xFF0C;urg&#xFF0C;ece&#xFF0C;cwr&#xFF0C;ns</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 tcp,tcp_flags<span class="token operator">=</span>ack,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>12.&#x5339;&#x914D;icmp code&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;icmp</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 icmp,icmp_code<span class="token operator">=</span>2,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>13.&#x5339;&#x914D;vlan TCI<br>
TCI&#x4F4E;12&#x4F4D;&#x4E3A;vlan id&#xFF0C;&#x9AD8;3&#x4F4D;&#x4E3A;priority&#xFF0C;&#x4F8B;&#x5982;tci=0xf123&#x5219;vlan_id&#x4E3A;0x123&#x548C;vlan_pcp=7</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,vlan_tci<span class="token operator">=</span>0xf123,actions<span class="token operator">=</span>output:2&#xFEFF;
</pre><p>14.&#x5339;&#x914D;mpls label<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x8847/0x8848</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 mpls,in_port<span class="token operator">=</span>1,mpls_label<span class="token operator">=</span>7,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>15.&#x5339;&#x914D;mpls tc&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-7<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x8847/0x8848</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 mpls,in_port<span class="token operator">=</span>1,mpls_tc<span class="token operator">=</span>7,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><p>16.&#x5339;&#x914D;tunnel id&#xFF0C;&#x6E90;/&#x76EE;&#x7684;IP</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x5339;&#x914D;tunnel id</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;tunnel-id&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,tun_id<span class="token operator">=</span>0x7/0xf,actions<span class="token operator">=</span>output:2
<span class="token comment">## &#x5339;&#x914D;tunnel&#x6E90;IP</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;tunnel&#x6E90;ip&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,tun_src<span class="token operator">=</span>192.168.1.0/255.255.255.0,actions<span class="token operator">=</span>output:2
<span class="token comment">## &#x5339;&#x914D;tunnel&#x76EE;&#x7684;IP</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5339;&#x914D;tunnel&#x76EE;&#x7684;ip&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,tun_dst<span class="token operator">=</span>192.168.1.0/255.255.255.0,actions<span class="token operator">=</span>output:2&#xFEFF;&#x200B;
</pre><h3>2.1. &#x4E00;&#x4E9B;&#x5339;&#x914D;&#x9879;&#x7684;&#x901F;&#x8BB0;&#x7B26;</h3>
<p>&#x901F;&#x8BB0;&#x7B26; &#x5339;&#x914D;&#x9879;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token function">ip</span> dl_type<span class="token operator">=</span>0x800
ipv6 dl_type<span class="token operator">=</span>0x86dd
icmp dl_type<span class="token operator">=</span>0x0800,nw_proto<span class="token operator">=</span>1
icmp6 dl_type<span class="token operator">=</span>0x86dd,nw_proto<span class="token operator">=</span>58
tcp dl_type<span class="token operator">=</span>0x0800,nw_proto<span class="token operator">=</span>6
tcp6 dl_type<span class="token operator">=</span>0x86dd,nw_proto<span class="token operator">=</span>6
udp dl_type<span class="token operator">=</span>0x0800,nw_proto<span class="token operator">=</span>17
udp6 dl_type<span class="token operator">=</span>0x86dd,nw_proto<span class="token operator">=</span>17
sctp dl_type<span class="token operator">=</span>0x0800,nw_proto<span class="token operator">=</span>132
sctp6 dl_type<span class="token operator">=</span>0x86dd,nw_proto<span class="token operator">=</span>132
arp dl_type<span class="token operator">=</span>0x0806
rarp dl_type<span class="token operator">=</span>0x8035
mpls dl_type<span class="token operator">=</span>0x8847
mplsm dl_type<span class="token operator">=</span>0x8848&#xFEFF;
</pre><h3>2.2. &#x6307;&#x4EE4;&#x52A8;&#x4F5C;</h3>
<p>1.&#x52A8;&#x4F5C;&#x4E3A;&#x51FA;&#x63A5;&#x53E3;<br>
&#x4ECE;&#x6307;&#x5B9A;&#x63A5;&#x53E3;&#x8F6C;&#x53D1;&#x51FA;&#x53BB;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=output:2&#xFEFF;&#x200B;
</code></pre><p>2.&#x52A8;&#x4F5C;&#x4E3A;&#x6307;&#x5B9A;group<br>
group id&#x4E3A;&#x5DF2;&#x521B;&#x5EFA;&#x7684;group table</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=group:666&#xFEFF;&#x200B;
</code></pre><p>3.&#x52A8;&#x4F5C;&#x4E3A;normal<br>
&#x8F6C;&#x4E3A;L2/L3&#x5904;&#x7406;&#x6D41;&#x7A0B;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=normal
</code></pre><p>4.&#x52A8;&#x4F5C;&#x4E3A;flood<br>
&#x4ECE;&#x6240;&#x6709;&#x7269;&#x7406;&#x63A5;&#x53E3;&#x8F6C;&#x53D1;&#x51FA;&#x53BB;&#xFF0C;&#x9664;&#x4E86;&#x5165;&#x63A5;&#x53E3;&#x548C;&#x5DF2;&#x5173;&#x95ED;flooding&#x7684;&#x63A5;&#x53E3;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=flood&#xFEFF;
</code></pre><p>5.&#x52A8;&#x4F5C;&#x4E3A;all<br>
&#x4ECE;&#x6240;&#x6709;&#x7269;&#x7406;&#x63A5;&#x53E3;&#x8F6C;&#x53D1;&#x51FA;&#x53BB;&#xFF0C;&#x9664;&#x4E86;&#x5165;&#x63A5;&#x53E3;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=all&#xFEFF;
</code></pre><p>6.&#x52A8;&#x4F5C;&#x4E3A;local<br>
&#x4E00;&#x822C;&#x662F;&#x8F6C;&#x53D1;&#x7ED9;&#x672C;&#x5730;&#x7F51;&#x6865;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=local&#xFEFF;
</code></pre><p>7.&#x52A8;&#x4F5C;&#x4E3A;in_port<br>
&#x4ECE;&#x5165;&#x63A5;&#x53E3;&#x8F6C;&#x53D1;&#x56DE;&#x53BB;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=in_port&#xFEFF;
</code></pre><p>8.&#x52A8;&#x4F5C;&#x4E3A;controller<br>
&#x4EE5;packet-in&#x6D88;&#x606F;&#x4E0A;&#x9001;&#x7ED9;&#x63A7;&#x5236;&#x5668;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=controller&#xFEFF;
</code></pre><p>9.&#x52A8;&#x4F5C;&#x4E3A;drop<br>
&#x4E22;&#x5F03;&#x6570;&#x636E;&#x5305;&#x64CD;&#x4F5C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=drop&#xFEFF;&#x200B;
</code></pre><p>10.&#x52A8;&#x4F5C;&#x4E3A;mod_vlan_vid<br>
&#x4FEE;&#x6539;&#x62A5;&#x6587;&#x7684;vlan id&#xFF0C;&#x8BE5;&#x9009;&#x9879;&#x4F1A;&#x4F7F;vlan_pcp&#x7F6E;&#x4E3A;0</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=mod_vlan_vid:8,output:2
</code></pre><p>11.&#x52A8;&#x4F5C;&#x4E3A;mod_vlan_pcp<br>
&#x4FEE;&#x6539;&#x62A5;&#x6587;&#x7684;vlan&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x8BE5;&#x9009;&#x9879;&#x4F1A;&#x4F7F;vlan_id&#x7F6E;&#x4E3A;0</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=mod_vlan_pcp:7,output:2
</code></pre><p>12.&#x52A8;&#x4F5C;&#x4E3A;strip_vlan<br>
&#x5265;&#x6389;&#x62A5;&#x6587;&#x5185;&#x5916;&#x5C42;vlan tag</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=strip_vlan,output:2&#xFEFF;
</code></pre><p>13.&#x52A8;&#x4F5C;&#x4E3A;push_vlan<br>
&#x5728;&#x62A5;&#x6587;&#x5916;&#x5C42;&#x538B;&#x5165;&#x4E00;&#x5C42;vlan tag&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;openflow1.1&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x517C;&#x5BB9;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow -O OpenFlow13 br0 in_port=1,actions=push_vlan:0x8100,set_field:4097-\&gt;vlan_vid,output:2
</code></pre><p>ps: set field&#x503C;&#x4E3A;4096+vlan_id&#xFF0C;&#x5E76;&#x4E14;vlan&#x4F18;&#x5148;&#x7EA7;&#x4E3A;0&#xFF0C;&#x5373;4096-8191&#xFF0C;&#x5BF9;&#x5E94;&#x7684;vlan_id&#x4E3A;0-4095</p>
<p>14.&#x52A8;&#x4F5C;&#x4E3A;push_mpls<br>
&#x4FEE;&#x6539;&#x62A5;&#x6587;&#x7684;ethertype&#xFF0C;&#x5E76;&#x4E14;&#x538B;&#x5165;&#x4E00;&#x4E2A;MPLS LSE</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=push_mpls:0x8847,set_field:10-\&gt;mpls_label,output:2&#xFEFF;&#x200B;
</code></pre><p>15.&#x52A8;&#x4F5C;&#x4E3A;pop_mpls<br>
&#x5265;&#x6389;&#x6700;&#x5916;&#x5C42;mpls&#x6807;&#x7B7E;&#xFF0C;&#x5E76;&#x4E14;&#x4FEE;&#x6539;ethertype&#x4E3A;&#x975E;mpls&#x7C7B;&#x578B;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 mpls,in_port=1,mpls_label=20,actions=pop_mpls:0x0800,output:2
</code></pre><p>16.&#x52A8;&#x4F5C;&#x4E3A;&#x4FEE;&#x6539;&#x6E90;/&#x76EE;&#x7684;MAC&#xFF0C;&#x4FEE;&#x6539;&#x6E90;/&#x76EE;&#x7684;IP</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x4FEE;&#x6539;&#x6E90;MAC</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;&#x6E90;mac&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_dl_src:00:00:00:00:00:01,output:2
<span class="token comment">## &#x4FEE;&#x6539;&#x76EE;&#x7684;MAC</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;&#x76EE;&#x7684;mac&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_dl_dst:00:00:00:00:00:01,output:2
<span class="token comment">## &#x4FEE;&#x6539;&#x6E90;IP</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;&#x6E90;ip&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_nw_src:192.168.1.1,output:2
<span class="token comment">## &#x4FEE;&#x6539;&#x76EE;&#x7684;IP</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;&#x76EE;&#x7684;ip&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_nw_dst:192.168.1.1,output:2
</pre><p>17.&#x52A8;&#x4F5C;&#x4E3A;&#x4FEE;&#x6539;TCP/UDP/SCTP&#x6E90;&#x76EE;&#x7684;&#x7AEF;&#x53E3;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x4FEE;&#x6539;TCP&#x6E90;&#x7AEF;&#x53E3;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;tcp&#x6E90;&#x7AEF;&#x53E3;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 tcp,in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_tp_src:67,output:2
<span class="token comment">## &#x4FEE;&#x6539;TCP&#x76EE;&#x7684;&#x7AEF;&#x53E3;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;tcp&#x76EE;&#x7684;&#x7AEF;&#x53E3;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 tcp,in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_tp_dst:68,output:2
<span class="token comment">## &#x4FEE;&#x6539;UDP&#x6E90;&#x7AEF;&#x53E3;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;udp&#x6E90;&#x7AEF;&#x53E3;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 udp,in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_tp_src:67,output:2
<span class="token comment">## &#x4FEE;&#x6539;UDP&#x76EE;&#x7684;&#x7AEF;&#x53E3;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x4FEE;&#x6539;udp&#x76EE;&#x7684;&#x7AEF;&#x53E3;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 udp,in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>mod_tp_dst:68,output:2
</pre><p>18.&#x52A8;&#x4F5C;&#x4E3A;mod_nw_tos<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800<br>
&#x4FEE;&#x6539;ToS&#x5B57;&#x6BB5;&#x7684;&#x9AD8;6&#x4F4D;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255&#xFF0C;&#x503C;&#x5FC5;&#x987B;&#x4E3A;4&#x7684;&#x500D;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x53BB;&#x4FEE;&#x6539;ToS&#x4F4E;2&#x4F4D;ecn&#x503C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 ip,in_port=1,actions=mod_nw_tos:68,output:2
</code></pre><p>19.&#x52A8;&#x4F5C;&#x4E3A;mod_nw_ecn<br>
&#x6761;&#x4EF6;&#xFF1A;&#x6307;&#x5B9A;dl_type=0x0800&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;openflow1.1&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x517C;&#x5BB9;<br>
&#x4FEE;&#x6539;ToS&#x5B57;&#x6BB5;&#x7684;&#x4F4E;2&#x4F4D;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-3&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x53BB;&#x4FEE;&#x6539;ToS&#x9AD8;6&#x4F4D;&#x7684;DSCP&#x503C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 ip,in_port=1,actions=mod_nw_ecn:2,output:2
</code></pre><p>20.&#x52A8;&#x4F5C;&#x4E3A;mod_nw_ttl<br>
&#x4FEE;&#x6539;IP&#x62A5;&#x6587;ttl&#x503C;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;openflow1.1&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#x517C;&#x5BB9;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow -O OpenFlow13 br0 in_port=1,actions=mod_nw_ttl:6,output:2
</code></pre><p>21.&#x52A8;&#x4F5C;&#x4E3A;dec_ttl<br>
&#x5BF9;IP&#x62A5;&#x6587;&#x8FDB;&#x884C;ttl&#x81EA;&#x51CF;&#x64CD;&#x4F5C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=dec_ttl,output:2
</code></pre><p>22.&#x52A8;&#x4F5C;&#x4E3A;set_mpls_label<br>
&#x5BF9;&#x62A5;&#x6587;&#x6700;&#x5916;&#x5C42;mpls&#x6807;&#x7B7E;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;20bit&#x503C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=set_mpls_label:666,output:2&#xFEFF;
</code></pre><p>23.&#x52A8;&#x4F5C;&#x4E3A;set_mpls_tc<br>
&#x5BF9;&#x62A5;&#x6587;&#x6700;&#x5916;&#x5C42;mpls tc&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-7</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=set_mpls_tc:7,output:2
</code></pre><p>24.&#x52A8;&#x4F5C;&#x4E3A;set_mpls_ttl<br>
&#x5BF9;&#x62A5;&#x6587;&#x6700;&#x5916;&#x5C42;mpls ttl&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=set_mpls_ttl:255,output:2
</code></pre><p>25.&#x52A8;&#x4F5C;&#x4E3A;dec_mpls_ttl<br>
&#x5BF9;&#x62A5;&#x6587;&#x6700;&#x5916;&#x5C42;mpls ttl&#x8FDB;&#x884C;&#x81EA;&#x51CF;&#x64CD;&#x4F5C;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,actions=dec_mpls_ttl,output:2&#xFEFF;
</code></pre><p>26.&#x52A8;&#x4F5C;&#x4E3A;move NXM&#x5B57;&#x6BB5;<br>
&#x4F7F;&#x7528;move&#x53C2;&#x6570;&#x5BF9;NXM&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
<ul>
<li>&#x5C06;&#x62A5;&#x6587;&#x6E90;MAC&#x590D;&#x5236;&#x5230;&#x76EE;&#x7684;MAC&#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x6E90;MAC&#x6539;&#x4E3A;00:00:00:00:00:01</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash">ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>move:NXM_OF_ETH_SRC<span class="token punctuation">[</span><span class="token punctuation">]</span>-\<span class="token operator">&gt;</span>NXM_OF_ETH_DST<span class="token punctuation">[</span><span class="token punctuation">]</span>,mod_dl_src:00:00:00:00:00:01,output:2&#xFEFF;&#x200B;
</pre><ul>
<li>ps: &#x5E38;&#x7528;NXM&#x5B57;&#x6BB5;&#x53C2;&#x7167;&#x8868;</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash">NXM&#x5B57;&#x6BB5; &#x62A5;&#x6587;&#x5B57;&#x6BB5;
NXM_OF_ETH_SRC &#x6E90;MAC
NXM_OF_ETH_DST &#x76EE;&#x7684;MAC
NXM_OF_ETH_TYPE &#x4EE5;&#x592A;&#x7F51;&#x7C7B;&#x578B;
NXM_OF_VLAN_TCI vid
NXM_OF_IP_PROTO IP&#x534F;&#x8BAE;&#x53F7;
NXM_OF_IP_TOS IP ToS&#x503C;
NXM_NX_IP_ECN IP ToS ECN
NXM_OF_IP_SRC &#x6E90;IP
NXM_OF_IP_DST &#x76EE;&#x7684;IP
NXM_OF_TCP_SRC TCP&#x6E90;&#x7AEF;&#x53E3;
NXM_OF_TCP_DST TCP&#x76EE;&#x7684;&#x7AEF;&#x53E3;
NXM_OF_UDP_SRC UDP&#x6E90;&#x7AEF;&#x53E3;
NXM_OF_UDP_DST UDP&#x76EE;&#x7684;&#x7AEF;&#x53E3;
NXM_OF_SCTP_SRC SCTP&#x6E90;&#x7AEF;&#x53E3;
NXM_OF_SCTP_DST SCTP&#x76EE;&#x7684;&#x7AEF;&#x53E3;&#xFEFF;&#x200B;
</pre><p>27.&#x52A8;&#x4F5C;&#x4E3A;load NXM&#x5B57;&#x6BB5;<br>
&#x4F7F;&#x7528;load&#x53C2;&#x6570;&#x5BF9;NXM&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## push mpls label&#xFF0C;&#x5E76;&#x4E14;&#x628A;10(0xa)&#x8D4B;&#x503C;&#x7ED9;mpls label</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;push-mpls-label&#x5E76;&#x4E14;&#x628A;100xa&#x8D4B;&#x503C;&#x7ED9;mpls-label&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>push_mpls:0x8847,load:0xa-\<span class="token operator">&gt;</span>OXM_OF_MPLS_LABEL<span class="token punctuation">[</span><span class="token punctuation">]</span>,output:2
<span class="token comment">## &#x5BF9;&#x76EE;&#x7684;MAC&#x8FDB;&#x884C;&#x8D4B;&#x503C;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5BF9;&#x76EE;&#x7684;mac&#x8FDB;&#x884C;&#x8D4B;&#x503C;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1,actions<span class="token operator">=</span>load:0x001122334455-\<span class="token operator">&gt;</span>OXM_OF_ETH_DST<span class="token punctuation">[</span><span class="token punctuation">]</span>,output:2&#xFEFF;&#x200B;
</pre><p>28.&#x52A8;&#x4F5C;&#x4E3A;pop_vlan<br>
&#x5F39;&#x51FA;&#x62A5;&#x6587;&#x6700;&#x5916;&#x5C42;vlan tag</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=1,dl_type=0x8100,dl_vlan=777,actions=pop_vlan,output:2
</code></pre><h3>2.3. meter&#x8868;</h3>
<p>&#x5E38;&#x7528;&#x64CD;&#x4F5C;<br>
&#x7531;&#x4E8E;meter&#x8868;&#x662F;openflow1.3&#x7248;&#x672C;&#x4EE5;&#x540E;&#x624D;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x9700;&#x8981;&#x6307;&#x5B9A;OpenFlow1.3&#x7248;&#x672C;&#x4EE5;&#x4E0A;<br>
ps: &#x5728;openvswitch-v2.8&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x8FD8;&#x4E0D;&#x652F;&#x6301;meter<br>
&#x5728;v2.8&#x7248;&#x672C;&#x4E4B;&#x540E;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#xFF0C;&#x8981;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;datapath&#x7C7B;&#x578B;&#x8981;&#x6307;&#x5B9A;&#x4E3A;netdev&#xFF0C;band type&#x6682;&#x65F6;&#x53EA;&#x652F;&#x6301;drop&#xFF0C;&#x8FD8;&#x4E0D;&#x652F;&#x6301;DSCP REMARK</p>
<p>1.&#x67E5;&#x770B;&#x5F53;&#x524D;&#x8BBE;&#x5907;&#x5BF9;meter&#x7684;&#x652F;&#x6301;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 meter-features br0&#xFEFF;
</code></pre><p>2.&#x67E5;&#x770B;meter&#x8868;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 meter-features br0&#xFEFF;&#x200B;
</code></pre><p>3.&#x67E5;&#x770B;meter&#x7EDF;&#x8BA1;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 meter-stats br0
</code></pre><p>4.&#x521B;&#x5EFA;meter&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x9650;&#x901F;&#x7C7B;&#x578B;&#x4EE5;kbps(kilobits per second)&#x8BA1;&#x7B97;&#xFF0C;&#x8D85;&#x8FC7;20kb/s&#x5219;&#x4E22;&#x5F03;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x9650;&#x901F;&#x7C7B;&#x578B;&#x4EE5;kbpskilobits-per-second&#x8BA1;&#x7B97;&#x8D85;&#x8FC7;20kbs&#x5219;&#x4E22;&#x5F03;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 add-meter br0 meter<span class="token operator">=</span>1,kbps,band<span class="token operator">=</span>type<span class="token operator">=</span>drop,rate<span class="token operator">=</span>20
<span class="token comment">## &#x540C;&#x4E0A;&#xFF0C;&#x589E;&#x52A0;burst size&#x53C2;&#x6570;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x540C;&#x4E0A;&#x589E;&#x52A0;burst-size&#x53C2;&#x6570;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 add-meter br0 meter<span class="token operator">=</span>2,kbps,band<span class="token operator">=</span>type<span class="token operator">=</span>drop,rate<span class="token operator">=</span>20,burst_size<span class="token operator">=</span>256
<span class="token comment">## &#x540C;&#x4E0A;&#xFF0C;&#x589E;&#x52A0;stats&#x53C2;&#x6570;,&#x5BF9;meter&#x8FDB;&#x884C;&#x8BA1;&#x6570;&#x7EDF;&#x8BA1;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x540C;&#x4E0A;&#x589E;&#x52A0;stats&#x53C2;&#x6570;&#x5BF9;meter&#x8FDB;&#x884C;&#x8BA1;&#x6570;&#x7EDF;&#x8BA1;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

group&#x8868;
&#x7531;&#x4E8E;group&#x8868;&#x662F;openflow1.1&#x7248;&#x672C;&#x4EE5;&#x540E;&#x624D;&#x652F;&#x6301;&#xFF0C;&#x6240;&#x4EE5;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x9700;&#x8981;&#x6307;&#x5B9A;OpenFlow1.1&#x7248;&#x672C;&#x4EE5;&#x4E0A;

ovs-ofctl -O OpenFlow13 add-meter br0 meter<span class="token operator">=</span>3,kbps,stats,band<span class="token operator">=</span>type<span class="token operator">=</span>drop,rate<span class="token operator">=</span>20,burst_size<span class="token operator">=</span>256
<span class="token comment">## &#x9650;&#x901F;&#x7C7B;&#x578B;&#x4EE5;pktps(packets per second)&#x8BA1;&#x7B97;&#xFF0C;&#x8D85;&#x8FC7;1000pkt/s&#x5219;&#x4E22;&#x5F03;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x9650;&#x901F;&#x7C7B;&#x578B;&#x4EE5;pktpspackets-per-second&#x8BA1;&#x7B97;&#x8D85;&#x8FC7;1000pkts&#x5219;&#x4E22;&#x5F03;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 add-meter br0 meter<span class="token operator">=</span>4,pktps,band<span class="token operator">=</span>type<span class="token operator">=</span>drop,rate<span class="token operator">=</span>1000&#xFEFF;
</pre><p>5.&#x5220;&#x9664;meter&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x5220;&#x9664;&#x5168;&#x90E8;meter&#x8868;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5220;&#x9664;&#x5168;&#x90E8;meter&#x8868;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 del-meters br0
<span class="token comment">## &#x5220;&#x9664;meter id=1</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5220;&#x9664;meter-id1&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 del-meter br0 meter<span class="token operator">=</span>1
</pre><p>6.&#x521B;&#x5EFA;&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 add-flow br0 in_port=1,actions=meter:1,output:
</code></pre><h3>2.4. &#x5E38;&#x7528;&#x64CD;&#x4F5C;</h3>
<h3>2.5. group table&#x652F;&#x6301;&#x79CD;&#x7C7B;&#x578B;</h3>
<p>all&#xFF1A;&#x6240;&#x6709;buckets&#x90FD;&#x6267;&#x884C;&#x4E00;&#x904D;<br>
select&#xFF1A; &#x6BCF;&#x6B21;&#x9009;&#x62E9;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;bucket&#x6267;&#x884C;&#xFF0C;&#x5E38;&#x7528;&#x4E8E;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x5E94;&#x7528;<br>
ff(FAST FAILOVER)&#xFF1A;&#x5FEB;&#x901F;&#x6545;&#x969C;&#x4FEE;&#x590D;&#xFF0C;&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x89E3;&#x51B3;&#x63A5;&#x53E3;&#x7B49;&#x6545;&#x969C;<br>
indirect&#xFF1A;&#x95F4;&#x63A5;&#x6267;&#x884C;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x53E6;&#x4E00;&#x4E2A;group&#x6765;&#x8C03;&#x7528;</p>
<p>1.&#x67E5;&#x770B;&#x5F53;&#x524D;&#x8BBE;&#x5907;&#x5BF9;group&#x7684;&#x652F;&#x6301;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 dump-group-features br0&#xFEFF;
</code></pre><p>2.&#x67E5;&#x770B;group&#x8868;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 dump-groups br0
</code></pre><p>3.&#x521B;&#x5EFA;group&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x7C7B;&#x578B;&#x4E3A;all</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x7C7B;&#x578B;&#x4E3A;all&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 add-group br0 group_id<span class="token operator">=</span>1,type<span class="token operator">=</span>all,bucket<span class="token operator">=</span>output:1,bucket<span class="token operator">=</span>output:2,bucket<span class="token operator">=</span>output:3
<span class="token comment">## &#x7C7B;&#x578B;&#x4E3A;select</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x7C7B;&#x578B;&#x4E3A;select&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow13 add-group br0 group_id<span class="token operator">=</span>2,type<span class="token operator">=</span>select,bucket<span class="token operator">=</span>output:1,bucket<span class="token operator">=</span>output:2,bucket<span class="token operator">=</span>output:3
<span class="token comment">## &#x7C7B;&#x578B;&#x4E3A;select&#xFF0C;&#x6307;&#x5B9A;hash&#x65B9;&#x6CD5;(5&#x5143;&#x7EC4;&#xFF0C;OpenFlow1.5+)</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x7C7B;&#x578B;&#x4E3A;select&#x6307;&#x5B9A;hash&#x65B9;&#x6CD5;5&#x5143;&#x7EC4;openflow15&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl -O OpenFlow15 add-group br0 group_id<span class="token operator">=</span>3,type<span class="token operator">=</span>select,selection_method<span class="token operator">=</span>hash,fields<span class="token operator">=</span>ip_src,bucket<span class="token operator">=</span>output:2,bucket<span class="token operator">=</span>output:3&#xFEFF;
</pre><p>4.&#x5220;&#x9664;group&#x8868;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 del-groups br0 group_id=2
</code></pre><p>5.&#x521B;&#x5EFA;&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl -O OpenFlow13 add-flow br0 in_port=1,actions=group:2
</code></pre><h3>2.6. goto table&#x914D;&#x7F6E;</h3>
<p>&#x6570;&#x636E;&#x6D41;&#x5148;&#x4ECE;table0&#x5F00;&#x59CB;&#x5339;&#x914D;&#xFF0C;&#x5982;actions&#x6709;goto_table&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x540E;&#x7EED;table&#x7684;&#x5339;&#x914D;&#xFF0C;&#x5B9E;&#x73B0;&#x591A;&#x7EA7;&#x6D41;&#x6C34;&#x7EBF;&#xFF0C;&#x5982;&#x9700;&#x4F7F;&#x7528;goto table&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x6D41;&#x8868;&#x65F6;&#xFF0C;&#x6307;&#x5B9A;table id&#xFF0C;&#x8303;&#x56F4;&#x4E3A;0-255&#xFF0C;&#x4E0D;&#x6307;&#x5B9A;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;table0<br>
1.&#x5728;table0&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x6761;&#x6D41;&#x8868;&#x6761;&#x76EE;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 table=0,in_port=1,actions=goto_table=1
</code></pre><p>2.&#x5728;table1&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x6761;&#x6D41;&#x8868;&#x6761;&#x76EE;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 table=1,ip,nw_dst=10.10.0.0/16,actions=output:2&#xFEFF;&#x200B;
</code></pre><h3>2.7. tunnel&#x914D;&#x7F6E;</h3>
<p>&#x5982;&#x9700;&#x914D;&#x7F6E;tunnel&#xFF0C;&#x5FC5;&#x9700;&#x786E;&#x4FDD;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x5BF9;&#x5404;tunnel&#x7684;remote ip&#x7F51;&#x7EDC;&#x53EF;&#x8FBE;</p>
<h3>2.8. gre</h3>
<p>1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;gre&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;id=1001</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl add-port br0 gre1 -- set Interface gre1 type=gre options:remote_ip=1.1.1.1 ofport_request=1001
</code></pre><p>2.&#x53EF;&#x9009;&#x9009;&#x9879;<br>
&#x5C06;tos&#x6216;&#x8005;ttl&#x5728;&#x96A7;&#x9053;&#x4E0A;&#x7EE7;&#x627F;&#xFF0C;&#x5E76;&#x5C06;tunnel id&#x8BBE;&#x7F6E;&#x6210;123</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl set Interface gre1 options:tos=inherit options:ttl=inherit options:key=123&#xFEFF;&#x200B;
</code></pre><p>3.&#x521B;&#x5EFA;&#x5173;&#x4E8E;gre&#x6D41;&#x8868;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment">## &#x5C01;&#x88C5;gre&#x8F6C;&#x53D1;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x5C01;&#x88C5;gre&#x8F6C;&#x53D1;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 ip,in_port<span class="token operator">=</span>1,nw_dst<span class="token operator">=</span>10.10.0.0/16,actions<span class="token operator">=</span>output:1001
<span class="token comment">## &#x89E3;&#x5C01;gre&#x8F6C;&#x53D1;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;&#x89E3;&#x5C01;gre&#x8F6C;&#x53D1;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-ofctl add-flow br0 in_port<span class="token operator">=</span>1001,actions<span class="token operator">=</span>output:1&#xFEFF;&#x200B;
</pre><h3>2.9. vxlan</h3>
<p>1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;vxlan&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x4E14;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;id=2001</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl add-port br0 vxlan1 -- set Interface vxlan1 type=vxlan options:remote_ip=1.1.1.1 ofport_request=2001&#xFEFF;
</code></pre><p>2.&#x53EF;&#x9009;&#x9009;&#x9879;<br>
&#x5C06;tos&#x6216;&#x8005;ttl&#x5728;&#x96A7;&#x9053;&#x4E0A;&#x7EE7;&#x627F;&#xFF0C;&#x5C06;vni&#x8BBE;&#x7F6E;&#x6210;123&#xFF0C;UDP&#x76EE;&#x7684;&#x7AEF;&#x4E3A;&#x8BBE;&#x7F6E;&#x6210;8472(&#x9ED8;&#x8BA4;&#x4E3A;4789)</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl set Interface vxlan1 options:tos=inherit options:ttl=inherit options:key=123 options:dst_port=8472&#xFEFF;
</code></pre><p>3.&#x521B;&#x5EFA;&#x5173;&#x4E8E;vxlan&#x6D41;&#x8868;</p>
<p>&#x5C01;&#x88C5;vxlan&#x8F6C;&#x53D1;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 ip,in_port=1,nw_dst=10.10.0.0/16,actions=output:2001&#xFEFF;&#x200B;
</code></pre><p>&#x89E3;&#x5C01;vxlan&#x8F6C;&#x53D1;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-ofctl add-flow br0 in_port=2001,actions=output:1&#xFEFF;
</code></pre><h3>2.10. sflow&#x914D;&#x7F6E;</h3>
<p>1.&#x5BF9;&#x7F51;&#x6865;br0&#x8FDB;&#x884C;sflow&#x76D1;&#x63A7;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># agent: &#x4E0E;collector&#x901A;&#x4FE1;&#x6240;&#x5728;&#x7684;&#x7F51;&#x53E3;&#x540D;&#xFF0C;&#x901A;&#x5E38;&#x4E3A;&#x7BA1;&#x7406;&#x53E3;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;agent-&#x4E0E;collector&#x901A;&#x4FE1;&#x6240;&#x5728;&#x7684;&#x7F51;&#x53E3;&#x540D;&#x901A;&#x5E38;&#x4E3A;&#x7BA1;&#x7406;&#x53E3;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token comment"># target: collector&#x76D1;&#x542C;&#x7684;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x7AEF;&#x53E3;&#x9ED8;&#x8BA4;&#x4E3A;6343</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;target-collector&#x76D1;&#x542C;&#x7684;ip&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x7AEF;&#x53E3;&#x9ED8;&#x8BA4;&#x4E3A;6343&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token comment"># header: sFlow&#x5728;&#x91C7;&#x6837;&#x65F6;&#x622A;&#x53D6;&#x62A5;&#x6587;&#x5934;&#x7684;&#x957F;&#x5EA6;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;header-sflow&#x5728;&#x91C7;&#x6837;&#x65F6;&#x622A;&#x53D6;&#x62A5;&#x6587;&#x5934;&#x7684;&#x957F;&#x5EA6;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token comment"># polling: &#x91C7;&#x6837;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;</span>
<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">&quot;mume-header &quot;</span> id<span class="token operator">=</span><span class="token string">&quot;polling-&#x91C7;&#x6837;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5355;&#x4F4D;&#x4E3A;&#x79D2;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

ovs-vsctl -- --id<span class="token operator">=</span>@sflow create sflow agent<span class="token operator">=</span>eth0 target<span class="token operator">=</span>\&quot;10.0.0.1:6343\&quot; header<span class="token operator">=</span>128 sampling<span class="token operator">=</span>64 polling<span class="token operator">=</span>10 -- <span class="token keyword">set</span> bridge br0 sflow<span class="token operator">=</span>@sflow&#xFEFF;&#x200B;
</pre><p>2.&#x67E5;&#x770B;&#x521B;&#x5EFA;&#x7684;sflow</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl list sflow&#xFEFF;&#x200B;
</code></pre><p>3.&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x7F51;&#x6865;sflow&#x914D;&#x7F6E;&#xFF0C;&#x53C2;&#x6570;&#x4E3A;sFlow UUID</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl remove bridge br0 sflow 7b9b962e-fe09-407c-b224-5d37d9c1f2b3
</code></pre><p>4.&#x5220;&#x9664;&#x7F51;&#x6865;&#x4E0B;&#x6240;&#x6709;sflow&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl -- clear bridge br0 sflow
</code></pre><h3>2.11. QoS&#x914D;&#x7F6E;</h3>
<p>ingress policing<br>
1.&#x914D;&#x7F6E;ingress policing&#xFF0C;&#x5BF9;&#x63A5;&#x53E3;eth0&#x5165;&#x6D41;&#x9650;&#x901F;10Mbps</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl set interface eth0 ingress_policing_rate=10000
ovs-vsctl set interface eth0 ingress_policing_burst=8000&#xFEFF;&#x200B;
</code></pre><p>2.&#x6E05;&#x9664;&#x76F8;&#x5E94;&#x63A5;&#x53E3;&#x7684;ingress policer&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl set interface eth0 ingress_policing_rate=0
ovs-vsctl set interface eth0 ingress_policing_burst=0&#xFEFF;&#x200B;
</code></pre><p>3.&#x67E5;&#x770B;&#x63A5;&#x53E3;ingress policer&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl list interface eth0
ovs-appctl qos/show-types br0
</code></pre><h3>2.12. &#x7AEF;&#x53E3;&#x955C;&#x50CF;&#x914D;&#x7F6E;</h3>
<p>1.&#x914D;&#x7F6E;eth0&#x6536;&#x5230;/&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x955C;&#x50CF;&#x5230;eth1</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl -- set bridge br0 mirrors=@m \
-- --id=@eth0 get port eth0 \
-- --id=@eth1 get port eth1 \
-- --id=@m create mirror name=mymirror select-dst-port=@eth0 select-src-port=@eth0 output-port=@eth1&#xFEFF;&#x200B;
</code></pre><p>2.&#x5220;&#x9664;&#x7AEF;&#x53E3;&#x955C;&#x50CF;&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl -- --id=@m get mirror mymirror -- remove bridge br0 mirrors @m
</code></pre><p>3.&#x6E05;&#x9664;&#x7F51;&#x6865;&#x4E0B;&#x6240;&#x6709;&#x7AEF;&#x53E3;&#x955C;&#x50CF;&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl clear bridge br0 mirrors
</code></pre><p>4.&#x67E5;&#x770B;&#x7AEF;&#x53E3;&#x955C;&#x50CF;&#x914D;&#x7F6E;</p>
<pre data-role="codeBlock" data-info class="language-"><code>ovs-vsctl get bridge br0 mirrors&#xFEFF;&#x200B;
</code></pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>