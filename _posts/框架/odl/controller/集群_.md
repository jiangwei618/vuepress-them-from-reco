---
title: 集群概述
date: 2019-09-18T09:58:55.000Z
description: 集群概述
categories:
    - 框架
    - odl
    - controller
tags:
    - odl
    - controller
    - owner
---  
  
  
  
##  1. odl集群
  
odl的三节点集群完全依赖akka集群构建。采用gossip协议收敛，并实现集群故障自动诊断。
[akka官网集群介绍](https://doc.akka.io/docs/akka/current/common/cluster.html )

![](../../../../images/78a8a3da94dbabe819e2dc92e1135e600.png?0.7193165059167004)  
##  2. shardManager
  
odl的每个节点均有一个shardManager。shardManager不组成集群，其主要职责如下
1. 负责处理本节点的分片创建
2. 负责接收集群节点的状态（cluster event ，eg：MemberUp），并触发数据库分片和ownershp动作
3. 持久化分片信息（persistShardList）

![](../../../../images/78a8a3da94dbabe819e2dc92e1135e601.png?0.16617610822255147)  
  
  
  
#  datastore shard
  
shardmanager会根据module-shards.conf中的配置创建shard，<strong> 如果replicas不存在A节点，则A不创建对应的shard </strong>。不通的节点的同一分片通过raft算法选出对应的leader 和 fllower。(shardmanager config 和operational 均会创建分片)

![](../../../../images/78a8a3da94dbabe819e2dc92e1135e602.png?0.005594845008501048)  
  
##  3. entityownership shard
  
entityownership shad 负责处理用户级别的选主，例如netconf和设备的链接主备。entityownership的选主有几种策略，FirstCandidateSelectionStrategy、LeastLoadedCandidateSelectionStrategy、LastCandidateSelectionStrategy。entityownership shard只存在于shard manager operational 下.entityownership shad 本身继承自shard，其选主也是通过raft算法。

![](../../../../images/78a8a3da94dbabe819e2dc92e1135e603.png?0.3918106476931804)  
  