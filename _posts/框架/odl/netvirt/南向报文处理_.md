---
title: 南向报文处理
date: 2019-08-22T17:09:22.000Z
description: 南向报文在netvirt中的处理
categories:
    - 框架
    - odl
    - netvirt
tags:
    - openflow
    - netvirt
---  
  
  
##  1. openflow 处理流程
  
  
&emsp;&emsp;openflow 中关于和设备连接有几个比较关键的类。这些类基本提供的 ovs 与设备连接的信息。
| 类 |
| ---------------------------- |
| DeviceContextImpl |
| ContextChainHolderImpl |
| SwitchConnectionProviderImpl |
| ConnectionAdapterImpl |
| OpenFlowPluginProviderImpl |
  
<details>
 <summary>openflow处理流程图</summary>
  

![](../../../../images/63b5b84e579ffac2ff08ec5bfebc076c0.png?0.8830456369175583)  
  
</details>
  
##  2. 监听 packet-received notification 的类.
  
  
&emsp;&emsp;所有监听 packet-received notification 的类均实现 `PacketProcessingListener`接口。且分布在以下三个模块，具体信息见表格。曾出现故障，由于 NotificationService 在调用监听器时，监听器抛出异常没有被捕获，导致 NotificationService 服务崩溃，后续的报文处理异常。
  
| 模块     | 类                         | 处理的报文类型                                      |
| -------- | -------------------------- | --------------------------------------------------- |
| openflow | LLDPDiscoveryListener      |                                                     |
| genius   | AlivenessMonitor           | 保活                                                |
| ^        | ArpUtilImpl                |                                                     |
| ^        | PacketInCounterHandler     | 统计报文                                            |
| neivirt  | DhcpPktHandler             | DHCP_TABLE（60）或 DHCP_TABLE_EXTERNAL_TUNNEL（18） |
| ^        | ElanPacketInHandler        | ELAN_SMAC_TABLE（50）                               |
| ^        | Ipv6PktHandler             | ipv6 报文                                           |
| ^        | NaptPacketInHandler        | OUTBOUND_NAPT_TABLE（46）                           |
| ^        | SubnetRoutePacketInHandler | L3_SUBNET_ROUTE_TABLE(22)                           |
  